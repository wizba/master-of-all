import type { Task } from './types';

export const domain1Tasks: Task[] = [
  {
    id: 'task-1.1',
    name: 'Task 1.1: Design Secure Access to AWS Resources',
    cards: [
      {
        id: 'iam-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'IAM Fundamentals',
        icon: '\u{1F510}',
        awsIcon: 'iam',
        question: 'What are the 4 core components of AWS IAM?',
        answer: '1. **Users** \u{1F464} - Individual entities with long-term credentials\n2. **Groups** \u{1F465} - Collections of users for simplified permission management\n3. **Roles** \u{1F3AD} - Temporary permissions without permanent credentials\n4. **Policies** \u{1F4DC} - JSON documents defining permissions',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'iam-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'IAM Fundamentals',
        icon: '\u{1F464}',
        awsIcon: 'iam',
        question: 'What is an IAM User?',
        answer: 'An IAM User is an individual entity (person or application) with **long-term credentials** (password, access keys) for direct AWS interaction.\n\n**Key Point**: Users have permanent credentials that should be rotated regularly.',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'iam-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'IAM Fundamentals',
        icon: '\u{1F465}',
        awsIcon: 'iam',
        question: 'What is an IAM Group and why use it?',
        answer: 'An IAM Group is a collection of IAM users.\n\n**Purpose**: Simplifies permission management by attaching policies to groups instead of individual users.\n\n**Example**: Create a "Developers" group with S3 and EC2 permissions - all users in the group inherit these permissions.',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'iam-4',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'IAM Fundamentals',
        icon: '\u{1F3AD}',
        awsIcon: 'iam',
        question: 'What is an IAM Role and when should you use it?',
        answer: 'An IAM Role grants **temporary permissions** to AWS services or trusted external entities **without permanent credentials**.\n\n**Use Cases**:\n\u2022 EC2 instance accessing S3 \u2705\n\u2022 Lambda function accessing DynamoDB \u2705\n\u2022 Cross-account access \u2705\n\u2022 External identity federation \u2705',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'iam-5',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'IAM Fundamentals',
        icon: '\u{1F4DC}',
        awsIcon: 'iam',
        question: 'What is an IAM Policy?',
        answer: 'A **JSON document** that defines specific permissions (allowed or denied actions on resources).\n\n**Attached to**: Users, Groups, or Roles\n\n**Example Structure**:\n```json\n{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Effect": "Allow",\n    "Action": "s3:GetObject",\n    "Resource": "arn:aws:s3:::mybucket/*"\n  }]\n}\n```',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'polp-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Principle of Least Privilege',
        icon: '\u{1F6E1}\uFE0F',
        awsIcon: 'iam',
        question: 'What is the Principle of Least Privilege (PoLP)?',
        answer: 'The Principle of Least Privilege grants **only the minimum permissions needed** for a user or service to perform its task.\n\n**Benefits**:\n\u2022 Reduces attack surface \u{1F3AF}\n\u2022 Limits blast radius of breaches \u{1F4A5}\n\u2022 Easier to audit \u{1F4CB}\n\u2022 Contains compromised credentials \u{1F512}',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'polp-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Principle of Least Privilege',
        icon: '\u26A0\uFE0F',
        awsIcon: 'iam',
        question: 'What is the main problem with granting `*` permissions on `*` resources?',
        answer: '**This creates a massive security hole!** \u{1F6A8}\n\nGranting all actions (`*`) on all resources (`*`) means:\n\u2022 User can do ANYTHING in your AWS account\n\u2022 No containment if credentials are compromised\n\u2022 Violates least privilege principle\n\u2022 Difficult to audit what\'s actually being used\n\n**Never do this in production!**',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'polp-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Principle of Least Privilege',
        icon: '\u{1F3AF}',
        awsIcon: 'iam',
        question: 'What are the 3 key benefits of implementing Least Privilege?',
        answer: '1. **Reduced Attack Surface** \u{1F3AF}\n   Fewer ways for attackers to exploit privileges\n\n2. **Limited Blast Radius** \u{1F4A5}\n   If credentials are compromised, damage is contained\n\n3. **Improved Auditability** \u{1F4CA}\n   Easier to understand and review access patterns',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'iam-mc-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'IAM Fundamentals',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'Which IAM entity provides temporary credentials?',
        options: [
          'IAM User',
          'IAM Group',
          'IAM Role',
          'IAM Policy'
        ],
        correctAnswer: 2,
        explanation: '**IAM Roles** provide temporary credentials. Unlike Users (permanent credentials) or Groups (just containers for users), Roles are assumed temporarily by services or users.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'iam-mc-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'IAM Fundamentals',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'What is the primary purpose of IAM Groups?',
        options: [
          'Store AWS resources',
          'Simplify permission management for multiple users',
          'Provide temporary credentials',
          'Define actions allowed on resources'
        ],
        correctAnswer: 1,
        explanation: '**IAM Groups** simplify permission management by allowing you to attach policies to a collection of users instead of managing permissions individually.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'polp-mc-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Principle of Least Privilege',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'Which permission set follows the Principle of Least Privilege for a backup application?',
        options: [
          'Full S3 administrator access to all buckets',
          's3:* permissions on specific backup bucket',
          's3:PutObject and s3:GetObject on specific backup bucket',
          'Read-only access to entire AWS account'
        ],
        correctAnswer: 2,
        explanation: '**s3:PutObject and s3:GetObject on specific backup bucket** follows PoLP by granting ONLY the minimum permissions needed (read/write) on ONLY the specific bucket required.',
        type: 'multiple-choice',
        difficulty: 'application'
      },
      {
        id: 'iam-scenario-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'IAM Best Practices',
        icon: '\u{1F3AF}',
        awsIcon: 'ec2',
        question: 'SCENARIO: An application on EC2 needs to access S3. Should you hardcode AWS credentials or use an IAM role?',
        answer: '**Use an IAM Role** \u2705\n\n**Why**:\n\u2022 No hardcoded credentials in code \u{1F512}\n\u2022 Temporary credentials automatically rotated \u{1F504}\n\u2022 Follows least privilege principle \u{1F4CA}\n\u2022 More secure and maintainable \u{1F4AA}\n\n**Wrong Approach** \u274C: Hardcoding access keys in application code creates security risks and maintenance nightmares.',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'iam-scenario-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'IAM Best Practices',
        icon: '\u{1F3E2}',
        awsIcon: 'iam',
        question: 'SCENARIO: You have 50 developers who all need the same S3 and EC2 permissions. What\'s the best approach?',
        answer: '**Create an IAM Group** (e.g., "Developers") and attach policies to the group \u2705\n\n**Benefits**:\n\u2022 Manage permissions in ONE place \u{1F3AF}\n\u2022 Add/remove users easily \u{1F465}\n\u2022 Consistent permissions across team \u2696\uFE0F\n\u2022 Audit trail simplification \u{1F4DD}\n\n**Wrong Approach** \u274C: Attaching policies to each individual user = management nightmare and inconsistent permissions.',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'polp-scenario-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Principle of Least Privilege',
        icon: '\u{1F4BE}',
        awsIcon: 's3',
        question: 'SCENARIO: A user manages S3 backups. What permissions should they have?',
        answer: '**Grant specific permissions on specific bucket** \u2705\n\nInstead of `AmazonS3FullAccess` (too broad), grant:\n\u2022 `s3:PutObject` - Upload backups\n\u2022 `s3:GetObject` - Download backups\n\u2022 `s3:ListBucket` - List backup files\n\n**Only on**: `arn:aws:s3:::backup-bucket/*`\n\n**Why**: Follows PoLP - user can only manage backups, not delete production data or access other buckets.',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'polp-scenario-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Principle of Least Privilege',
        icon: '\u26A1',
        awsIcon: 'lambda',
        question: 'SCENARIO: A Lambda function needs to read from DynamoDB and write logs to CloudWatch. What should its execution role include?',
        answer: '**Grant only required permissions** \u2705\n\n**Required Permissions**:\n\u2022 `dynamodb:GetItem` on specific table\n\u2022 `dynamodb:Query` on specific table\n\u2022 `logs:CreateLogGroup`\n\u2022 `logs:CreateLogStream`\n\u2022 `logs:PutLogEvents`\n\n**NOT**:\n\u274C Full DynamoDB access\n\u274C All CloudWatch permissions\n\u274C Any EC2, S3, or unrelated permissions\n\n**Benefit**: If Lambda is compromised, attacker can only read that one DynamoDB table - can\'t delete data, access other services, or launch EC2 instances.',
        type: 'scenario',
        difficulty: 'advanced'
      },
      {
        id: 'polp-scenario-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Principle of Least Privilege',
        icon: '\u{1F513}',
        awsIcon: 'iam',
        question: 'SCENARIO: Your team lead wants to grant a contractor full admin access "to get started quickly". What are the security risks?',
        answer: '**This violates PoLP and creates serious risks!** \u{1F6A8}\n\n**Risks**:\n\u2022 Contractor can access ALL AWS resources \u{1F631}\n\u2022 Can create/delete production infrastructure \u{1F4A3}\n\u2022 Can view sensitive data, credentials, billing \u{1F513}\n\u2022 Can create backdoor IAM users for persistence \u{1F6AA}\n\u2022 If contractor\'s credentials leak, entire AWS account is compromised \u{1F4A5}\n\n**Better Approach** \u2705:\n1. Identify specific tasks contractor needs\n2. Grant only those permissions\n3. Use IAM role with session duration limits\n4. Add condition keys (source IP, MFA, time-based)\n5. Regular access reviews',
        type: 'scenario',
        difficulty: 'advanced'
      },
      {
        id: 'iam-mc-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'IAM Best Practices',
        icon: '\u2753',
        awsIcon: 'ec2',
        question: 'An EC2 instance needs to read from an S3 bucket. What is the MOST secure approach?',
        options: [
          'Hardcode AWS access keys in the application code',
          'Store credentials in an environment variable on the instance',
          'Attach an IAM role to the EC2 instance',
          'Create an IAM user and share the password'
        ],
        correctAnswer: 2,
        explanation: '**Attach an IAM role** to the EC2 instance. This provides temporary, automatically-rotating credentials without storing permanent credentials on the instance. This follows AWS security best practices and the principle of least privilege.',
        type: 'multiple-choice',
        difficulty: 'application'
      },
      {
        id: 'iam-policy-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'IAM Policies',
        icon: '\u{1F4C4}',
        awsIcon: 'iam',
        question: 'What does this IAM policy do?\n```json\n{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Effect": "Allow",\n    "Action": [\n      "s3:GetObject",\n      "s3:PutObject"\n    ],\n    "Resource": "arn:aws:s3:::my-bucket/*"\n  }]\n}\n```',
        answer: 'This policy **allows**:\n\u2705 Reading objects (`s3:GetObject`)\n\u2705 Writing objects (`s3:PutObject`)\n\nFrom the bucket: `my-bucket`\n\n**Important**: The `/*` at the end means it applies to all objects IN the bucket, not the bucket itself.\n\n**Missing**: Permission to list the bucket (`s3:ListBucket` would need `arn:aws:s3:::my-bucket` without `/*`)',
        type: 'code-analysis',
        difficulty: 'application'
      },
      {
        id: 'iam-policy-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'IAM Policies',
        icon: '\u{1F4C4}',
        awsIcon: 'iam',
        question: 'What does this IAM policy do?\n```json\n{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Effect": "Deny",\n    "Action": "s3:DeleteObject",\n    "Resource": "*"\n  }]\n}\n```',
        answer: 'This policy **explicitly denies** deleting any S3 object across ALL buckets (`"Resource": "*"`).\n\n**Key Point**: \u{1F6AB} **Explicit Deny always wins** - even if another policy allows `s3:DeleteObject`, this deny will override it.\n\n**Use Case**: Prevent accidental deletion of critical data across the entire AWS account.',
        type: 'code-analysis',
        difficulty: 'application'
      },
      {
        id: 'polp-policy-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Principle of Least Privilege',
        icon: '\u{1F4C4}',
        awsIcon: 's3',
        question: 'Does this policy follow the Principle of Least Privilege for a backup user?\n```json\n{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Effect": "Allow",\n    "Action": "s3:*",\n    "Resource": "arn:aws:s3:::backup-bucket/*"\n  }]\n}\n```',
        answer: '**No, this violates PoLP!** \u274C\n\n**Problem**: `s3:*` grants ALL S3 actions including:\n\u2022 `s3:DeleteObject` - Can delete backups \u{1F5D1}\uFE0F\n\u2022 `s3:DeleteBucket` - Can delete entire bucket \u{1F4A3}\n\u2022 `s3:PutBucketPolicy` - Can change bucket security \u{1F513}\n\n**Better Approach** \u2705:\n```json\n{\n  "Effect": "Allow",\n  "Action": ["s3:PutObject", "s3:GetObject", "s3:ListBucket"],\n  "Resource": "arn:aws:s3:::backup-bucket/*"\n}\n```\n\nOnly grant what\'s needed for backups!',
        type: 'code-analysis',
        difficulty: 'advanced'
      },
      {
        id: 'iam-principle-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Security Principles',
        icon: '\u{1F6E1}\uFE0F',
        awsIcon: 'iam',
        question: 'What is the Least Privilege Principle in IAM?',
        answer: '**Least Privilege**: Grant only the minimum permissions needed to perform a task - nothing more.\n\n**Example**:\n\u274C Bad: Give full S3 admin access when only read access is needed\n\u2705 Good: Grant only `s3:GetObject` permission for specific buckets\n\n**Benefits**:\n\u2022 Reduces blast radius of security breaches \u{1F4A5}\n\u2022 Limits accidental damage \u{1F6E1}\uFE0F\n\u2022 Compliance requirement \u{1F4CB}',
        type: 'concept',
        difficulty: 'fundamental'
      },
      {
        id: 'polp-reflection-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Principle of Least Privilege',
        icon: '\u{1F914}',
        awsIcon: 'lambda',
        question: 'How does applying PoLP to a Lambda function\'s execution role enhance your serverless application\'s security posture?',
        answer: '**PoLP transforms Lambda security** \u{1F680}\n\n**Without PoLP** \u274C:\n\u2022 Lambda has broad permissions\n\u2022 Compromised function = full AWS access\n\u2022 Code vulnerabilities can be exploited widely\n\u2022 Hard to audit what function actually needs\n\n**With PoLP** \u2705:\n\u2022 Function can only access specific DynamoDB table, specific S3 bucket\n\u2022 Code injection attacks are contained \u{1F512}\n\u2022 Accidental bugs can\'t destroy infrastructure \u{1F6E1}\uFE0F\n\u2022 Clear audit trail of what resources are touched \u{1F4CA}\n\u2022 Compliance: demonstrates security controls \u{1F4CB}\n\n**Defense in Depth**: Even if your Lambda code has a vulnerability, the blast radius is minimal.',
        type: 'concept',
        difficulty: 'advanced'
      },
            {
        id: 'mfa-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u{1F510}',
        awsIcon: 'iam',
        question: 'What is Multi-Factor Authentication (MFA) in simple terms?',
        answer: '**MFA = Password + Something You Have**\n\nInstead of just typing a password (one factor), you also need a second thing—like a code from your phone or a physical security key.\n\n**Example**: \n1. Enter password \u2705\n2. Enter 6-digit code from phone app \u2705\n3. Now you\'re in! \u{1F513}',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'mfa-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u{1F3AF}',
        awsIcon: 'iam',
        question: 'Why is MFA important if I already have a strong password?',
        answer: '**Even strong passwords can be stolen!** \u{1F6A8}\n\n**Password Alone**:\n\u2022 Can be phished (fake login pages)\n\u2022 Can be leaked in data breaches\n\u2022 Can be guessed by computers\n\n**With MFA**:\n\u2022 Thief needs your password AND your physical device\n\u2022 One factor compromised? Account still safe \u{1F6E1}\uFE0F\n\u2022 Blocks 99.9% of automated attacks (Microsoft research)',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'mfa-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u{1F464}',
        awsIcon: 'iam',
        question: 'Which AWS account MUST have MFA enabled above all others?',
        answer: '**The Root Account** \u{1F480}\n\n**Why?**\n\u2022 Root has **unlimited power** over your entire AWS account\n\u2022 Can delete everything, change billing, lock you out\n\u2022 Cannot be restricted by IAM policies\n\n**Rule**: Enable MFA on root account **immediately** after creating your AWS account—before doing anything else!',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'mfa-4',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u{1F4F1}',
        awsIcon: 'iam',
        question: 'What are the three main types of MFA devices AWS supports?',
        answer: '1. **Virtual MFA** \u{1F4F1}\n   Apps like Google Authenticator, Authy, Microsoft Authenticator\n   \n2. **Hardware MFA** \u{1F5A5}\uFE0F\n   Physical devices like YubiKey, RSA token\n   \n3. **SMS (Text Message)** \u{1F4E7}\n   Code sent to your phone (least secure, but better than nothing)',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'mfa-5',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u{1F465}',
        awsIcon: 'iam',
        question: 'Should regular IAM users (not just admins) use MFA?',
        answer: '**Yes! All IAM users should use MFA.** \u2705\n\n**Best Practice**: \n\u2022 Enable MFA for **all** users with console access\n\u2022 Especially important for users with any resource permissions\n\u2022 AWS now mandates MFA for privileged accounts starting mid-2024 [^2^]\n\n**Enforcement**: You can create IAM policies that **require** MFA—users can\'t do anything until they set it up!',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'mfa-mc-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'Which AWS account should have MFA enabled as the highest priority?',
        options: [
          'Any IAM user account',
          'The root account',
          'Only billing administrators',
          'Only EC2 service accounts'
        ],
        correctAnswer: 1,
        explanation: '**The root account** has unrestricted access to all AWS resources and cannot be limited by IAM policies. It is the most critical account to protect with MFA.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'mfa-mc-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'What does MFA protect against?',
        options: [
          'Only weak passwords',
          'Only phishing attacks',
          'Stolen or compromised credentials even if the password is strong',
          'Only insider threats'
        ],
        correctAnswer: 2,
        explanation: 'MFA protects against stolen or compromised credentials because even if an attacker obtains the password, they cannot access the account without the second factor (the physical device or app).',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'mfa-mc-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'Which of the following is the MOST secure MFA method for AWS?',
        options: [
          'SMS text message',
          'Virtual MFA app (Google Authenticator)',
          'Hardware security key (FIDO U2F like YubiKey)',
          'Email-based MFA code'
        ],
        correctAnswer: 2,
        explanation: '**Hardware security keys (FIDO U2F/FIDO2)** are the most secure because they are phishing-resistant. They use public key cryptography and require physical touch, making them immune to remote attacks that can affect SMS or virtual apps.',
        type: 'multiple-choice',
        difficulty: 'application'
      },
      {
        id: 'mfa-scenario-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u{1F3E2}',
        awsIcon: 'iam',
        question: 'SCENARIO: Your company has 20 developers with IAM access. Some haven\'t enabled MFA yet. How do you enforce this without manually checking each user?',
        answer: '**Use an IAM Policy to Enforce MFA** \u2705\n\nCreate a policy that **denies all actions** unless the user has authenticated with MFA:\n\n```json\n{\n  "Effect": "Deny",\n  "NotAction": [\n    "iam:CreateVirtualMFADevice",\n    "iam:EnableMFADevice",\n    "iam:GetUser"\n  ],\n  "Resource": "*",\n  "Condition": {\n    "BoolIfExists": {\n      "aws:MultiFactorAuthPresent": "false"\n    }\n  }\n}\n```\n\n**Result**: Users can\'t do anything except set up MFA until they complete MFA setup! [^3^]',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'mfa-scenario-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u{1F4B8}',
        awsIcon: 'iam',
        question: 'SCENARIO: Your CFO is worried about AWS account security after hearing about a competitor\'s breach. They ask: "What if someone steals our admin password?" How does MFA address this concern?',
        answer: '**MFA Neutralizes Stolen Passwords** \u{1F6E1}\uFE0F\n\n**The Threat**: Attacker steals admin password via phishing\n\n**Without MFA**: \n\u2022 Attacker has full admin access immediately \u{1F4A5}\n\u2022 Can delete resources, steal data, rack up bills\n\n**With MFA**:\n\u2022 Attacker enters password... then hits a wall \u{1F6AB}\n\u2022 Needs the physical MFA device or app\n\u2022 **Cannot proceed** without the second factor\n\n**Business Value**: Password theft becomes a minor incident, not a catastrophic breach. CFO can sleep better! \u{1F4CA}',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'mfa-policy-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u{1F4C4}',
        awsIcon: 'iam',
        question: 'What does this IAM policy condition check?\n```json\n"Condition": {\n  "BoolIfExists": {\n    "aws:MultiFactorAuthPresent": "false"\n  }\n}\n```',
        answer: '**It checks: "Is MFA NOT being used?"** \u2753\n\n**Breakdown**:\n\u2022 `aws:MultiFactorAuthPresent` = Was MFA used in this request?\n\u2022 `"false"` = Check if MFA is NOT present\n\u2022 `BoolIfExists` = Also true if the key doesn\'t exist (for CLI/API calls)\n\n**Used with**: `"Effect": "Deny"` to block access when MFA is missing\n\n**Why `IfExists`?** Without it, CLI users with long-term credentials could bypass the check because they don\'t send MFA data at all! [^3^]',
        type: 'code-analysis',
        difficulty: 'application'
      },
      {
        id: 'mfa-policy-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u{1F4C4}',
        awsIcon: 'iam',
        question: 'Analyze this MFA enforcement policy. What can a user do WITHOUT MFA?\n```json\n{\n  "Effect": "Deny",\n  "NotAction": [\n    "iam:CreateVirtualMFADevice",\n    "iam:EnableMFADevice",\n    "iam:ListVirtualMFADevices",\n    "iam:ResyncMFADevice",\n    "iam:GetUser",\n    "sts:GetSessionToken"\n  ],\n  "Resource": "*",\n  "Condition": {\n    "BoolIfExists": {\n      "aws:MultiFactorAuthPresent": "false"\n    }\n  }\n}\n```',
        answer: '**Users WITHOUT MFA can ONLY**:\n\u2705 Create a virtual MFA device\n\u2705 Enable/setup their MFA device\n\u2705 List their MFA devices\n\u2705 Resync MFA device (if time is off)\n\u2705 View their own user info\n\u2705 Get a session token (for CLI MFA)\n\n**Users CANNOT**:\n\u274C Access S3, EC2, or any other AWS services\n\u274C View billing information\n\u274C Modify any resources\n\n**This is a "Force MFA" policy**—it locks users out until they set up MFA! [^6^]',
        type: 'code-analysis',
        difficulty: 'application'
      },
      {
        id: 'mfa-concept-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u{1F914}',
        awsIcon: 'iam',
        question: 'How does MFA fundamentally change the security model compared to just using passwords?',
        answer: '**From "Something You Know" to "Something You Know + Something You Have"** \n\n**Single Factor (Password)**:\n\u2022 Knowledge-based\n\u2022 Can be copied, guessed, phished\n\u2022 One point of failure\n\n**Multi-Factor**:\n\u2022 **Knowledge** (password) + **Possession** (device)\n\u2022 Must compromise TWO different things\n\u2022 Physical separation (attacker in Russia can\'t steal your phone in NYC)\n\u2022 **Asymmetric security**: Easy for legitimate user, hard for attacker\n\n**Cloud Criticality**: In AWS, credentials can spawn unlimited resources. MFA ensures that even if credentials leak, attackers cannot access the "keys to the kingdom."',
        type: 'concept',
        difficulty: 'advanced'
      },
      {
        id: 'mfa-scenario-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u26A1',
        awsIcon: 'iam',
        question: 'SCENARIO: Your DevOps team uses AWS CLI extensively with automated scripts. How can you enforce MFA without breaking automation?',
        answer: '**Different Strategies for Humans vs. Automation** \u2699\uFE0F\n\n**For Human CLI Users**:\n\u2022 Enforce MFA via IAM policy with `BoolIfExists`\n\u2022 Users run `sts get-session-token` with MFA to get temporary credentials\n\u2022 Use tools like `iam-mfa` to automate token refresh [^6^]\n\n**For Automation/Scripts**:\n\u274C **Don\'t use IAM users with MFA for automation!**\n\u2705 **Use IAM Roles** attached to EC2/Lambda/CodeBuild\n\u2705 Roles use temporary credentials automatically\n\u2705 No long-term credentials to steal\n\n**Key Insight**: MFA is for **human authentication**, not machine authentication. Machines use roles!',
        type: 'scenario',
        difficulty: 'advanced'
      },
      {
        id: 'mfa-policy-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u{1F4C4}',
        awsIcon: 'iam',
        question: 'This advanced policy uses `aws:MultiFactorAuthAge`. What does it do differently?\n```json\n"Condition": {\n  "NumericLessThan": {\n    "aws:MultiFactorAuthAge": "3600"\n  }\n}\n```',
        answer: '**It enforces a "session timeout" for MFA!** \u23F0\n\n**How it works**:\n\u2022 `aws:MultiFactorAuthAge` = Seconds since MFA was entered\n\u2022 `3600` = 1 hour (3600 seconds)\n\u2022 If user authenticated with MFA more than 1 hour ago, access is denied\n\n**Use Case**: \n\u2022 High-security environments\n\u2022 Force users to re-authenticate with MFA every hour\n\u2022 Limits window of opportunity if session is hijacked\n\n**Trade-off**: More secure, but more annoying for users (constant re-auth)',
        type: 'code-analysis',
        difficulty: 'advanced'
      },
      {
        id: 'mfa-scenario-4',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u{1F6A8}',
        awsIcon: 'iam',
        question: 'SCENARIO: A sophisticated attacker phishes your AWS admin, obtaining both their password AND their virtual MFA app\'s TOTP seed (by tricking them into scanning a malicious QR code). What MFA type would have prevented this?',
        answer: '**Hardware Security Keys (FIDO U2F/FIDO2)** \u{1F5A5}\uFE0F\n\n**Why Virtual MFA Failed**:\n\u2022 TOTP seeds can be stolen during setup\n\u2022 Attacker can generate same codes on their device\n\u2022 Phishing attack successful\n\n**Hardware Key Advantage**:\n\u2022 **Cryptographic challenge-response**: Key signs unique challenge for each login\n\u2022 **Phishing-resistant**: Won\'t work on fake sites (different domain = different key)\n\u2022 **No shared secrets**: Nothing to steal during setup\n\u2022 **Physical touch required**: Remote attackers cannot use the key\n\n**AWS Support**: FIDO2 keys are the gold standard for root account protection. [^1^]',
        type: 'scenario',
        difficulty: 'advanced'
      },
      {
        id: 'mfa-reflection-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'MFA Best Practices',
        icon: '\u{1F4AD}',
        awsIcon: 'iam',
        question: 'REFLECTION: Your organization wants to balance security with user convenience. The security team argues for hardware MFA keys for everyone, but developers complain about cost and carrying physical devices. How do you architect a tiered MFA strategy?',
        answer: '**Risk-Based Tiered MFA Strategy** \u2696\uFE0F\n\n**Tier 1 - Critical (Hardware Keys Required)**:\n\u2022 Root accounts\n\u2022 Billing administrators  \n\u2022 IAM administrators\n\u2022 Production database access\n\n**Tier 2 - High Risk (Virtual MFA Acceptable)**:\n\u2022 Regular admin users\n\u2022 Developers with broad permissions\n\u2022 Access to sensitive data\n\n**Tier 3 - Standard (Virtual MFA or SMS)**:\n\u2022 Read-only access users\n\u2022 Limited scope permissions\n\u2022 Temporary project access\n\n**Implementation**:\n\u2022 Use IAM policy conditions to enforce different MFA types by user group\n\u2022 Monitor with AWS Config rules for compliance\n\u2022 Regular audits of MFA device registration\n\n**Result**: Maximum protection where it matters, acceptable risk where it doesn\'t, cost-effective scaling.',
        type: 'scenario',
        difficulty: 'advanced'
      },
            {
        id: 'fed-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\u{1F465}',
        awsIcon: 'iam',
        question: 'What is federated access in simple terms?',
        answer: '**Use your company login for AWS** \ud83d\udd10\n\nInstead of creating a separate AWS password, you log in with your existing corporate credentials (like your company email/password).\n\n**Example**:\n1. Click "AWS Login" \u2705\n2. Get redirected to your company login page \u2705\n3. Enter your normal work password \u2705\n4. Automatically logged into AWS \u2705\n\n**No separate AWS passwords to remember!**',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'fed-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\u{1F3E2}',
        awsIcon: 'iam',
        question: 'Why is federated access better than creating IAM users for every employee?',
        answer: '**Centralized Management** \ud83c\udfaf\n\n**Without Federation (IAM Users)**:\n\u2022 Create/delete accounts in AWS manually \u274c\n\u2022 Employee leaves? Manually disable in AWS \u274c\n\u2022 Different password policies in each system \u274c\n\u2022 500 employees = 500 IAM users to manage \ud83d\ude31\n\n**With Federation**:\n\u2022 Manage users in ONE place (Active Directory/Okta) \u2705\n\u2022 Employee leaves? Disable once, access revoked everywhere \u2705\n\u2022 One security policy for all systems \u2705\n\u2022 AWS gets temporary credentials automatically \u2705',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'fed-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\u{1F510}',
        awsIcon: 'iam',
        question: 'What is AWS IAM Identity Center (formerly AWS SSO)?',
        answer: '**AWS\'s Built-in "Login Portal" for Multiple Accounts** \ud83c\udfe2\n\n**What it does**:\n\u2022 One dashboard to access multiple AWS accounts\n\u2022 One login for AWS + business apps (Salesforce, Office 365, etc.)\n\u2022 Built-in identity store OR connect to your corporate directory\n\u2022 Users get **temporary credentials** automatically\n\n**Think of it as**: A secure lobby where employees swipe their badge once, then get access to all the rooms (AWS accounts) they\'re authorized for.',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'fed-4',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\u23F3',
        awsIcon: 'iam',
        question: 'What are "temporary credentials" in federated access and why do they matter?',
        answer: '**Auto-Expiring Access Keys** \u23F0\n\n**How it works**:\n\u2022 User logs in via federation \u2705\n\u2022 AWS gives them temporary access (1-12 hours) \u2705\n\u2022 Credentials **automatically expire** \u2705\n\u2022 User must re-authenticate to get new ones \u2705\n\n**Security Benefit**:\n\u2022 No long-term passwords/access keys to steal\n\u2022 If credentials leak, they become useless after expiration\n\u2022 No need to rotate credentials manually\n\u2022 Follows least privilege automatically',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'fed-5',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\ud83d\udd17',
        awsIcon: 'iam',
        question: 'What are the two main protocols used for federated access?',
        answer: '1. **SAML 2.0** (Security Assertion Markup Language)\n   \ud83d\udcc4 XML-based, mature standard\n   Used by: Active Directory Federation Services (ADFS), Okta, Azure AD\n   \n2. **OpenID Connect (OIDC)**\n   \ud83d\udd17 JSON-based, modern web standard\n   Used by: Google, Auth0, GitHub, Cognito\n   \n**Analogy**: \n\u2022 SAML = Corporate badge scanner (enterprise)\n\u2022 OIDC = "Login with Google" button (web apps)',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'fed-mc-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'What is the primary benefit of using federated access instead of IAM users?',
        options: [
          'It is free to use',
          'Centralized identity management in one system',
          'It provides permanent credentials',
          'It does not require MFA'
        ],
        correctAnswer: 1,
        explanation: '**Centralized identity management** is the primary benefit. You manage users in one place (your corporate directory), and AWS trusts that identity provider. When an employee leaves, you disable them in one place and they lose AWS access automatically.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'fed-mc-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'Which AWS service provides single sign-on (SSO) access to multiple AWS accounts and business applications?',
        options: [
          'AWS Directory Service',
          'AWS IAM Identity Center (successor to AWS SSO)',
          'Amazon Cognito',
          'AWS Secrets Manager'
        ],
        correctAnswer: 1,
        explanation: '**AWS IAM Identity Center** (formerly AWS Single Sign-On) is the service that provides SSO access to multiple AWS accounts and business applications. It can use its own identity store or connect to external identity providers.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'fed-mc-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'In a federated access setup, what type of credentials do users receive to access AWS resources?',
        options: [
          'Permanent IAM user access keys',
          'Root account credentials',
          'Temporary security credentials',
          'Encrypted passwords stored in AWS'
        ],
        correctAnswer: 2,
        explanation: 'Users receive **temporary security credentials** that expire after a defined period (typically 1-12 hours). These are generated when the user assumes an IAM role through the identity provider, providing better security than long-term credentials.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'fed-scenario-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\ud83c\udfe2',
        awsIcon: 'iam',
        question: 'SCENARIO: Your company has 200 employees and 5 AWS accounts (Production, Staging, Dev, Security, Shared). Currently, you create IAM users in each account. An employee just quit. What is the operational risk, and how does federation solve it?',
        answer: '**The Risk: Orphaned Access** \ud83d\udea8\n\n**Current State (No Federation)**:\n\u2022 Must manually delete/disable 5 IAM users (one per account)\n\u2022 Easy to miss one = security hole \ud83d\udc65\n\u2022 Takes time = window of vulnerability \u23f0\n\u2022 No audit trail of who did what when\n\n**With Federation**:\n\u2022 Disable user in **one place** (Active Directory/Okta) \u2705\n\u2022 All 5 AWS accounts lose access **immediately** \u2705\n\u2022 Zero chance of forgetting an account \u2705\n\u2022 Centralized audit log \u2705\n\n**Business Impact**: Reduced operational overhead + eliminated security risk of orphaned accounts.',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'fed-scenario-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\ud83d\udcbc',
        awsIcon: 'iam',
        question: 'SCENARIO: Your DevOps team needs access to Production AWS account for emergencies only. With IAM Identity Center, how can you implement this without giving permanent access?',
        answer: '**Just-in-Time (JIT) Access with Permission Sets** \u26a1\n\n**Implementation**:\n1. **Permission Set**: Create "Production-Emergency-Access" with required permissions\n2. **Time Limits**: Set session duration to 1-2 hours maximum\n3. **Approval Workflow**: Configure requiring manager approval for elevated access\n4. **No Standing Access**: Users have **zero** permissions until they request access\n\n**User Flow**:\n1. Developer logs into Identity Center portal \u2705\n2. Sees "Production" account but cannot access yet \u2705\n3. Clicks "Request Access" → Manager gets notification \u2705\n4. Manager approves → Developer gets 2-hour session \u2705\n5. Auto-expires, access revoked \u2705\n\n**Result**: Principle of Least Privilege enforced dynamically. No permanent production access.',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'fed-concept-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\ud83e\udde9',
        awsIcon: 'iam',
        question: 'How does federation fundamentally change the security trust model compared to IAM users?',
        answer: '**From "AWS Manages Identity" to "AWS Trusts External Identity"** \ud83d\udd10\n\n**IAM User Model**:\n\u2022 AWS is the **source of truth** for identity\n\u2022 AWS stores passwords/credentials\n\u2022 AWS handles authentication\n\u2022 Security boundary: Within AWS\n\n**Federation Model**:\n\u2022 **External provider** is source of truth (Active Directory, Okta)\n\u2022 AWS **trusts** the external provider\'s assertion\n\u2022 AWS never sees the password\n\u2022 Security boundary: Extended to corporate identity system\n\n**Key Shift**: AWS shifts from **managing** identities to **consuming** identity assertions. This is more secure because:\n\u2022 Corporate systems have better monitoring\n\u2022 Single place to enforce MFA, password policies\n\u2022 Unified logging across all applications',
        type: 'concept',
        difficulty: 'application'
      },
      {
        id: 'fed-policy-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\ud83d\udcc4',
        awsIcon: 'iam',
        question: 'What does this IAM trust policy allow?\n```json\n{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Effect": "Allow",\n    "Principal": {\n      "Federated": "arn:aws:iam::123456789012:saml-provider/CompanyADFS"\n    },\n    "Action": "sts:AssumeRoleWithSAML",\n    "Condition": {\n      "StringEquals": {\n        "SAML:aud": "https://signin.aws.amazon.com/saml"\n      }\n    }\n  }]\n}\n```',
        answer: '**It allows SAML federation from Company ADFS** \ud83d\udd17\n\n**Breakdown**:\n\u2022 `Principal: Federated` = Trusts external SAML provider\n\u2022 `arn:aws:iam...:saml-provider/CompanyADFS` = Your corporate ADFS server\n\u2022 `sts:AssumeRoleWithSAML` = Exchange SAML assertion for AWS credentials\n\u2022 `Condition: SAML:aud` = Only valid for AWS sign-in endpoint (prevents token reuse)\n\n**What happens**:\n1. User authenticates with Company ADFS \u2705\n2. ADFS sends SAML assertion to AWS \u2705\n3. If assertion valid + condition matches, AWS grants temporary role credentials \u2705\n\n**Security**: The `Condition` ensures SAML tokens can\'t be stolen and used elsewhere.',
        type: 'code-analysis',
        difficulty: 'application'
      },
      {
        id: 'fed-scenario-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\ud83c\udf10',
        awsIcon: 'iam',
        question: 'SCENARIO: Your company uses Azure AD for corporate identities. You want developers to access AWS without creating IAM users. Architect the flow from login to AWS access.',
        answer: '**Azure AD to AWS Federation Architecture** \ud83c\udf10\n\n**Components**:\n1. **Azure AD** = Identity Provider (IdP) - stores users, handles MFA\n2. **IAM Identity Center** = AWS SSO service (or direct SAML to IAM)\n3. **IAM Roles** = Define what users can do in AWS\n\n**Authentication Flow**:\n1. Developer goes to AWS access portal \u2705\n2. Redirected to Azure AD login page \u2705\n3. Enters corporate credentials + MFA \u2705\n4. Azure AD sends SAML assertion to AWS \u2705\n5. AWS validates signature, maps to IAM Role \u2705\n6. Developer gets temporary credentials (1-12 hrs) \u2705\n\n**Mapping**: Azure AD groups (e.g., "AWS-Developers") map to IAM Roles (e.g., "Dev-Role") via Attribute-Based Access Control (ABAC).',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'fed-scenario-4',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\ud83d\udcca',
        awsIcon: 'iam',
        question: 'SCENARIO: Your security team needs to audit who accessed what in AWS. With 50 IAM users across 10 accounts, this is difficult. How does IAM Identity Center improve auditability?',
        answer: '**Centralized Audit Trail** \ud83d\udcca\n\n**Without Identity Center**:\n\u2022 Check CloudTrail in each of 10 accounts separately \u274c\n\u2022 Correlate IAM user names across accounts manually \u274c\n\u2022 No unified view of user activity \u274c\n\n**With Identity Center**:\n\u2022 **Single Identity**: john.smith@company.com across all accounts \u2705\n\u2022 **Centralized CloudTrail**: All sign-ins logged with corporate identity \u2705\n\u2022 **Access Portal Logs**: See which accounts each user accessed, when \u2705\n\u2022 **Permission Set Tracking**: Know exactly what permissions were granted \u2705\n\n**Advanced**: Use AWS Lake Formation to aggregate CloudTrail logs from all accounts, query with Athena: "Show me all actions by john.smith@company.com in Production last week."',
        type: 'scenario',
        difficulty: 'advanced'
      },
      {
        id: 'fed-concept-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\u2696\ufe0f',
        awsIcon: 'iam',
        question: 'What are the trade-offs between using IAM Identity Center\'s built-in identity store vs. connecting to an external identity provider?',
        answer: '**Built-in Store vs. External IdP Trade-offs** \u2696\ufe0f\n\n**Built-in Identity Store**:\n\u2705 **Pros**: Quick setup, no external dependencies, free, good for small orgs\n\u274c **Cons**: Separate passwords from corporate systems, manual user provisioning, no automatic sync with HR systems\n\n**External Identity Provider (Azure AD, Okta, etc.)**:\n\u2705 **Pros**: Single corporate password, automatic provisioning/deprovisioning, unified MFA, HR-driven access (joiner/mover/leaver processes)\n\u274c **Cons**: Complex setup, dependency on external system, requires SAML/OIDC expertise, potential latency if IdP is slow\n\n**Decision Matrix**:\n\u2022 < 50 users, no corporate directory? Use **Built-in**\n\u2022 > 50 users, have Azure AD/Okta? Use **External IdP**\n\u2022 High security/compliance requirements? Use **External IdP**',
        type: 'concept',
        difficulty: 'advanced'
      },
      {
        id: 'fed-policy-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\ud83d\udcc4',
        awsIcon: 'iam',
        question: 'Analyze this advanced trust policy using attribute-based conditions. What additional security does it provide?\n```json\n{\n  "Effect": "Allow",\n  "Principal": {\n    "Federated": "arn:aws:iam::123456789012:saml-provider/Okta"\n  },\n  "Action": "sts:AssumeRoleWithSAML",\n  "Condition": {\n    "StringEquals": {\n      "SAML:aud": "https://signin.aws.amazon.com/saml",\n      "SAML:iss": "http://www.okta.com/exkabcdef123"\n    },\n    "StringLike": {\n      "SAML:memberOf": "AWS-Production-Admins*"\n    },\n    "DateGreaterThan": {\n      "aws:CurrentTime": "2024-01-01T00:00:00Z"\n    }\n  }\n}\n```',
        answer: '**Multi-Layer Attribute-Based Access Control (ABAC)** \ud83d\udee1\ufe0f\n\n**Security Layers**:\n1. `SAML:aud` = Token can only be used for AWS sign-in (prevents replay attacks)\n2. `SAML:iss` = Only accepts assertions from specific Okta instance (prevents forged tokens from other Okta orgs)\n3. `SAML:memberOf` = User must be in "AWS-Production-Admins" group (authorization check)\n4. `DateGreaterThan` = Policy only valid after specific date (prevents use of old backups/tokens)\n\n**ABAC Benefit**: Instead of mapping individual users to roles, you map **attributes** (group membership). When someone moves teams, their access changes automatically in AWS without modifying IAM policies!',
        type: 'code-analysis',
        difficulty: 'advanced'
      },
      {
        id: 'fed-scenario-5',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\ud83c\udfaf',
        awsIcon: 'iam',
        question: 'SCENARIO: You are architecting access for a large enterprise with 5,000 employees, multiple subsidiaries, and strict compliance requirements (SOX, HIPAA). Design a comprehensive federated access strategy using IAM Identity Center.',
        answer: '**Enterprise-Scale Federated Architecture** \ud83c\udff0\n\n**Identity Architecture**:\n1. **Master Identity Provider**: Azure AD (primary corporate directory)\n   \u2022 Sync with on-prem Active Directory via Azure AD Connect\n   \u2022 HR-driven provisioning (automatically create/disable accounts)\n   \u2022 Corporate MFA enforced at IdP level\n\n2. **IAM Identity Center Configuration**:\n   \u2022 **Organization-wide**: Enable in AWS Organizations (master account)\n   \u2022 **Permission Sets**: \n     - `ViewOnlyAccess` (auditors, managers)\n     - `PowerUserAccess` (developers)\n     - `AdministratorAccess` (senior DevOps - requires approval)\n     - `HIPAA-Restricted` (healthcare data - additional MFA + IP restrictions)\n   \u2022 **Account Assignments**: Map Azure AD groups to AWS accounts\n\n3. **Compliance Controls**:\n   \u2022 **Session Duration**: 4 hours max (forces re-authentication)\n   \u2022 **Permission Boundaries**: Prevent privilege escalation even with Admin role\n   \u2022 **Service Control Policies (SCPs)**: Block sensitive services at Organization level\n   \u2022 **CloudTrail**: Centralized logging to immutable S3 bucket\n\n4. **Subsidiary Isolation**:\n   \u2022 Separate AWS Organizations for each subsidiary\n   \u2022 Cross-organization trust where needed\n   \u2022 Attribute-based access control ensures users only see their subsidiary resources\n\n**Result**: 5,000 users, zero IAM users, centralized governance, automatic compliance.',
        type: 'scenario',
        difficulty: 'advanced'
      },
      {
        id: 'fed-reflection-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Federated Access and IAM Identity Center',
        icon: '\ud83e\udd14',
        awsIcon: 'iam',
        question: 'REFLECTION: How does federated access fundamentally shift the burden of identity management and improve security for large organizations by streamlining access control?',
        answer: '**The Identity Management Paradigm Shift** \ud83d\udd04\n\n**Before Federation (IAM Users)**:\n\u2022 **Burden**: AWS administrators manage identities\n\u2022 **Process**: Onboard user? Create IAM user in N accounts. Offboard? Delete from N accounts. Rotate credentials? N times.\n\u2022 **Security Risk**: Orphaned accounts, inconsistent policies, credential sprawl\n\u2022 **Scale**: O(n\u00d7m) complexity (users \u00d7 accounts)\n\n**After Federation (IAM Identity Center)**:\n\u2022 **Burden Shift**: Identity team (HR/IT) manages in one system; AWS consumes assertions\n\u2022 **Process**: Onboard/offboard in ONE place; access propagates automatically to all AWS accounts\n\u2022 **Security Improvement**: \n  - No long-term credentials (temporary only)\n  - Unified MFA at corporate level (stronger than AWS-native)\n  - Immediate revocation (no delay)\n  - Attribute-based access (dynamic permissions based on role changes)\n\u2022 **Scale**: O(n) complexity (manage user once)\n\n**Fundamental Change**: AWS transforms from an **identity management system** to an **identity consumer**, leveraging enterprise-grade identity infrastructure that\'s already compliant, monitored, and integrated with HR systems. This is the difference between "managing users" and "managing trust relationships."',
        type: 'concept',
        difficulty: 'advanced'
      },
            {
        id: 'sts-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83d\udd10',
        awsIcon: 'iam',
        question: 'What is cross-account access in simple terms?',
        answer: '**Letting Account A access Account B\'s resources safely** \ud83d\udd17\n\n**The Problem**: You have two AWS accounts (Dev and Production). How do Dev users access a shared S3 bucket in Production without having Production passwords?\n\n**The Solution**: \n1. Create a special "door" (IAM Role) in Production account \u2705\n2. Give Dev account permission to knock on that door \u2705\n3. When Dev knocks, they get temporary keys for 1 hour \u2705\n4. Use those keys to access the S3 bucket \u2705\n5. Keys expire automatically \u2705\n\n**No sharing of permanent passwords!**',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'sts-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\u23f3',
        awsIcon: 'iam',
        question: 'What is AWS STS (Security Token Service) and what does it do?',
        answer: '**AWS STS = The "Temporary Key Maker"** \ud83d\udd11\n\n**STS is a web service that**:\n\u2022 Creates **temporary credentials** (Access Key + Secret Key + Session Token)\n\u2022 These credentials expire after 15 minutes to 12 hours\n\u2022 Used when assuming IAM roles (including cross-account)\n\u2022 **Free to use** - no cost for STS API calls\n\n**Think of it as**: A valet key for your car. Someone can use it temporarily, but it stops working after a set time, and you didn\'t have to give them your main key.',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'sts-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83d\udc65',
        awsIcon: 'iam',
        question: 'Why is cross-account access better than creating IAM users in multiple accounts?',
        answer: '**No Credential Sprawl** \ud83c\udfaf\n\n**The Old Way (IAM Users in Each Account)**:\n\u2022 Create "john_doe" in Account 1, Account 2, Account 3... \u274c\n\u2022 John has 3 passwords to manage \u274c\n\u2022 John leaves? Delete 3 accounts \u274c\n\u2022 Security audit? Check 3 accounts \u274c\n\n**The New Way (Cross-Account Roles)**:\n\u2022 John stays in Account 1 only \u2705\n\u2022 John assumes roles in Account 2 & 3 when needed \u2705\n\u2022 One identity, temporary access everywhere else \u2705\n\u2022 John leaves? Disable one account, all access gone \u2705\n\n**Result**: Centralized identity, decentralized access.',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'sts-4',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83d\udccb',
        awsIcon: 'iam',
        question: 'What are the three components of temporary credentials issued by STS?',
        answer: '**The "STS Trio"** \ud83d\udd11\n\n1. **Access Key ID** \ud83d\udc64\n   Like a username for the temporary session\n   \n2. **Secret Access Key** \ud83d\udd10\n   Like a password (keep this secret!)\n   \n3. **Session Token** \ud83d\udcfa\n   **Required for temporary credentials** - proves these are short-term keys\n\n**Important**: You MUST use all three together. Unlike long-term IAM user keys (which only have Access Key + Secret Key), STS credentials require the Session Token in every API call.',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'sts-5',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83d\udee1\ufe0f',
        awsIcon: 'iam',
        question: 'What is a "trust policy" in cross-account access?',
        answer: '**The "Who Can Knock" Rule** \ud83d\udecd\ufe0f\n\n**Trust Policy** = Attached to an IAM role, defines **which accounts or entities** are allowed to assume that role.\n\n**Example**: "Only Account A and Account B can assume this role"\n\n**Analogy**: \n\u2022 IAM Role = A secure room\n\u2022 Trust Policy = The guest list at the door\n\u2022 Permissions Policy = What guests can do once inside\n\n**Key Point**: Trust policy controls **WHO** can enter, permissions policy controls **WHAT** they can do inside.',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'sts-mc-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'Which AWS service issues temporary credentials for cross-account access?',
        options: [
          'AWS KMS',
          'AWS STS (Security Token Service)',
          'AWS IAM',
          'AWS Secrets Manager'
        ],
        correctAnswer: 1,
        explanation: '**AWS STS (Security Token Service)** issues temporary credentials that include an Access Key ID, Secret Access Key, and Session Token. These credentials are used when assuming IAM roles, including cross-account roles.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'sts-mc-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'What is the maximum duration for temporary credentials issued by STS when assuming a role?',
        options: [
          '1 hour',
          '6 hours',
          '12 hours',
          '24 hours'
        ],
        correctAnswer: 2,
        explanation: 'The maximum duration for temporary credentials issued by STS when assuming a role is **12 hours** (43,200 seconds). The default is 1 hour, but this can be configured up to 12 hours when assuming the role.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'sts-mc-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'In cross-account access, what does the trust policy on an IAM role define?',
        options: [
          'What actions the role can perform on resources',
          'Which AWS accounts or entities can assume the role',
          'How long the temporary credentials are valid',
          'Which regions the role can be used in'
        ],
        correctAnswer: 1,
        explanation: 'The **trust policy** defines which AWS accounts, IAM users, or other entities are trusted to assume the IAM role. It answers "who can use this role?" while the permissions policy answers "what can they do?"',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'sts-scenario-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83d\udcca',
        awsIcon: 'iam',
        question: 'SCENARIO: Your security team needs to audit S3 buckets in 10 different AWS accounts. They currently have IAM users in each account. How does cross-account access with STS improve this?',
        answer: '**Centralized Auditing with Temporary Access** \ud83d\udcca\n\n**Current State (Bad)**:\n\u2022 10 IAM users for the same person \u274c\n\u2022 10 passwords to manage \u274c\n\u2022 Access never expires (standing privileges) \u274c\n\u2022 Auditor leaves? Delete 10 users \u274c\n\n**Improved State (Cross-Account)**:\n\u2022 Security team stays in central "Audit" account \u2705\n\u2022 Create "AuditRole" in each of the 10 accounts \u2705\n\u2022 Trust policy allows Audit account to assume role \u2705\n\u2022 Auditors get temporary credentials (1-4 hours) \u2705\n\u2022 Automatic expiration = no standing privileges \u2705\n\u2022 One identity, temporary access everywhere \u2705\n\n**Security Win**: If auditor credentials compromised, attacker only has 1 hour window, not permanent access!',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'sts-scenario-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83d\udcbc',
        awsIcon: 'iam',
        question: 'SCENARIO: A developer in Account A needs to deploy code to an ECS cluster in Account B (Production). Architect the secure cross-account access flow.',
        answer: '**Secure Deployment Pipeline Architecture** \ud83d\ude80\n\n**Setup in Production (Account B)**:\n1. **Create IAM Role**: `CrossAccountDeploymentRole`\n2. **Trust Policy**: Allow Account A to assume this role\n3. **Permissions Policy**: Only `ecs:UpdateService` and `iam:PassRole` for specific ECS cluster\n4. **External ID**: Add secret string to prevent "confused deputy" attacks\n5. **Session Duration**: 15 minutes (minimum needed for deployment)\n\n**Execution Flow**:\n1. Developer/CI in Account A calls `sts:AssumeRole` \u2705\n2. Specifies role ARN in Account B + External ID \u2705\n3. STS returns temporary credentials (15 min) \u2705\n4. Use credentials to call `ecs:UpdateService` \u2705\n5. Credentials expire, access automatically revoked \u2705\n\n**Security Features**:\n\u2022 No long-term credentials in Account B \u2705\n\u2022 Least privilege (only ECS update, not full admin) \u2705\n\u2022 Time-bound access (15 min window) \u2705\n\u2022 External ID prevents unauthorized assumption \u2705',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'sts-policy-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83d\udcc4',
        awsIcon: 'iam',
        question: 'What does this trust policy allow?\n```json\n{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Effect": "Allow",\n    "Principal": {\n      "AWS": "arn:aws:iam::111111111111:root"\n    },\n    "Action": "sts:AssumeRole",\n    "Condition": {\n      "StringEquals": {\n        "sts:ExternalId": "unique-secret-id-123"\n      }\n    }\n  }]\n}\n```',
        answer: '**Allows Account A (111111111111) to assume this role ONLY with the correct External ID** \ud83d\udd10\n\n**Breakdown**:\n\u2022 `Principal: AWS: arn:aws:iam::111111111111:root` = Trusts entire Account A\n\u2022 `Action: sts:AssumeRole` = Can assume this role\n\u2022 `Condition: sts:ExternalId` = **MUST** provide "unique-secret-id-123"\n\n**Why External ID?**\nPrevents "confused deputy" attack where a malicious third party tricks Account A into assuming your role. The external ID acts like a password that only the legitimate requester knows.\n\n**Note**: `root` in the principal doesn\'t mean root user—it means "any IAM entity in that account."',
        type: 'code-analysis',
        difficulty: 'application'
      },
      {
        id: 'sts-concept-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83d\udca1',
        awsIcon: 'iam',
        question: 'How do temporary credentials via STS fundamentally improve security over sharing long-term access keys?',
        answer: '**The "Time-Bound Security" Principle** \u23f0\n\n**Long-Term Keys (Dangerous)**:\n\u2022 Valid until manually rotated (months/years) \u274c\n\u2022 If leaked, attacker has permanent access \u274c\n\u2022 Hard to revoke instantly (must delete user/rotate key) \u274c\n\u2022 No audit trail of when key was used \u274c\n\n**Temporary Credentials (Secure)**:\n\u2022 Auto-expire (15 min - 12 hours) \u2705\n\u2022 If leaked, window of attack is limited \u2705\n\u2022 No need to revoke—they die automatically \u2705\n\u2022 Every use logged in CloudTrail with session info \u2705\n\u2022 Tied to specific role assumption (audit who assumed what) \u2705\n\n**Fundamental Shift**: From "protecting secrets forever" to "limiting exposure time." Even if credentials are compromised, the blast radius is contained by time.',
        type: 'concept',
        difficulty: 'application'
      },
      {
        id: 'sts-scenario-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83c\udf10',
        awsIcon: 'iam',
        question: 'SCENARIO: You have a SaaS product that needs to access customer AWS accounts to perform backups. How do you securely architect this using cross-account roles without creating IAM users in customer accounts?',
        answer: '**SaaS Cross-Account Architecture** \ud83c\udf10\n\n**The "Confused Deputy" Problem**:\nIf you just trust your SaaS account ID, a malicious customer could trick your service into accessing another customer\'s account!\n\n**Secure Architecture**:\n1. **Customer Creates Role** in their account:\n   ```json\n   {\n     "Effect": "Allow",\n     "Principal": {\n       "AWS": "arn:aws:iam::YOUR-SAAS-ACCOUNT-ID:root"\n     },\n     "Action": "sts:AssumeRole",\n     "Condition": {\n       "StringEquals": {\n         "sts:ExternalId": "CUSTOMER-UNIQUE-ID-12345"\n       }\n     }\n   }\n   ```\n\n2. **Your SaaS Stores**: Customer Account ID + External ID mapping\n\n3. **When Backup Runs**:\n   \u2022 Look up customer\'s External ID in your database \u2705\n   \u2022 Call `sts:AssumeRole` with that External ID \u2705\n   \u2022 Get temporary credentials \u2705\n   \u2022 Perform backup \u2705\n   \u2022 Credentials expire \u2705\n\n**Security**: Even if Customer A knows Customer B\'s account ID, they can\'t access it without Customer B\'s unique External ID!',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'sts-policy-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83d\udcc4',
        awsIcon: 'iam',
        question: 'Analyze this advanced cross-account policy. What security controls are implemented?\n```json\n{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Effect": "Allow",\n    "Principal": {\n      "AWS": "arn:aws:iam::111111111111:role/SpecificDeploymentRole"\n    },\n    "Action": "sts:AssumeRole",\n    "Condition": {\n      "StringEquals": {\n        "sts:ExternalId": "prod-deploy-secret-456"\n      },\n      "IpAddress": {\n        "aws:SourceIp": ["203.0.113.0/24", "198.51.100.10/32"]\n      },\n      "DateGreaterThan": {\n        "aws:CurrentTime": "2024-01-01T00:00:00Z"\n      },\n      "Bool": {\n        "aws:MultiFactorAuthPresent": "true"\n      }\n    }\n  }]\n}\n```',
        answer: '**Defense-in-Depth with 4 Condition Layers** \ud83d\udee1\ufe0f\n\n**Security Controls**:\n1. **Specific Principal**: Only `SpecificDeploymentRole` in Account A (not entire account) \u2705\n2. **External ID**: Prevents confused deputy attacks \u2705\n3. **IP Whitelist**: Only allow assumption from corporate network (203.0.113.0/24) or specific jump box \u2705\n4. **Time Boundary**: Policy only valid after specific date (prevents replay of old tokens) \u2705\n5. **MFA Required**: Must authenticate with MFA to assume role \u2705\n\n**Result**: An attacker needs to:\n\u2022 Compromise the specific deployment role \u274c\n\u2022 Know the external ID \u274c\n\u2022 Be on the corporate network \u274c\n\u2022 Have MFA device \u274c\n\u2022 All within the valid time window \u274c\n\n**This is "Zero Trust" cross-account access!**',
        type: 'code-analysis',
        difficulty: 'advanced'
      },
      {
        id: 'sts-scenario-4',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83c\udff0',
        awsIcon: 'iam',
        question: 'SCENARIO: You are designing a multi-account AWS environment for a large enterprise (50+ accounts). The security team needs read-only access to all accounts, developers need deployment access to specific environments, and finance needs billing access only. Architect the cross-account strategy using AWS Organizations and STS.',
        answer: '**Enterprise Multi-Account Access Architecture** \ud83c\udff0\n\n**Account Structure** (AWS Organizations):\n- **Master Account**: Billing, Organizations, IAM Identity Center\n- **Security Account**: Central logging, security tools, audit role hub\n- **Shared Services**: CI/CD, monitoring\n- **Workload Accounts**: Dev, Staging, Prod (multiple business units)\n\n**Cross-Account Role Strategy**:\n\n**1. Security Team (Read-Only Everywhere)**:\n   \u2022 Role Name: `SecurityAuditRole` (consistent in ALL accounts)\n   \u2022 Trust Policy: Trust Security Account ID\n   \u2022 Permissions: `ReadOnlyAccess` + `SecurityAudit` managed policies\n   \u2022 Session Duration: 4 hours\n   \u2022 Access: Via IAM Identity Center or direct STS assume from Security Account\n\n**2. Developers (Environment-Specific)**:\n   \u2022 `Dev-Deployment-Role`: Full access in Dev accounts\n   \u2022 `Staging-Deployment-Role`: Limited access in Staging\n   \u2022 `Prod-Deployment-Role`: CI/CD only, no human access, requires approval workflow\n   \u2022 Trust: Shared Services account (for CI/CD) + specific developer IAM roles\n\n**3. Finance (Billing Only)**:\n   \u2022 `BillingViewRole`: `billing:ViewBilling` only\n   \u2022 Trust: Master Account only\n   \u2022 Condition: Corporate IP range only\n\n**Implementation**:\n\u2022 **Service Control Policies (SCPs)**: Prevent modification of cross-account roles at Organization level\n\u2022 **CloudTrail**: Centralized in Security Account, logs all `sts:AssumeRole` calls\n\u2022 **Tagging Strategy**: Roles tagged with `Environment`, `AccessLevel` for automated compliance checks\n\u2022 **Rotation**: External IDs rotated quarterly via automation\n\n**Result**: 50 accounts, 3 role types, centralized governance, zero IAM users in workload accounts, complete audit trail.',
        type: 'scenario',
        difficulty: 'advanced'
      },
      {
        id: 'sts-concept-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83d\udd04',
        awsIcon: 'iam',
        question: 'What is the "Confused Deputy" problem in cross-account access, and how does the External ID solve it?',
        answer: '**The "Confused Deputy" Attack** \ud83d\udea8\n\n**The Scenario**:\n1. You (Account C) offer a service that accesses customer AWS accounts\n2. Customer A (Account A) sets up a role trusting your Account C\n3. Customer B (Account B) is malicious and wants to access Customer A\'s data\n4. Customer B tricks your service into making API calls on their behalf\n5. Your service (the "confused deputy") assumes Customer A\'s role for Customer B!\n\n**Why It Works**: The trust policy only checks if the caller is Account C. It doesn\'t verify if Account C is acting on behalf of the legitimate owner.\n\n**External ID Solution**:\n\u2022 Unique secret string per customer (like a password)\n\u2022 Customer A includes External ID "secret-a-123" in their trust policy\n\u2022 Your service must provide "secret-a-123" when assuming the role\n\u2022 Customer B doesn\'t know this secret, so assumption fails \u2705\n\n**Analogy**: Like a call center agent verifying your identity with a PIN before discussing your account, even though they work for the trusted company.',
        type: 'concept',
        difficulty: 'advanced'
      },
      {
        id: 'sts-scenario-5',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83d\udd10',
        awsIcon: 'iam',
        question: 'SCENARIO: A third-party vendor needs emergency access to your production account during an outage. You want to grant access that (1) requires approval, (2) auto-expires in 30 minutes, (3) is limited to specific EC2 instances, and (4) leaves a complete audit trail. Design this using STS and IAM.',
        answer: '**Break-Glass Emergency Access Architecture** \ud83d\udea8\n\n**Components**:\n\n**1. Break-Glass Role in Production**:\n   ```json\n   {\n     "Effect": "Allow",\n     "Principal": { "AWS": "arn:aws:iam::VENDOR-ACCOUNT:root" },\n     "Action": "sts:AssumeRole",\n     "Condition": {\n       "StringEquals": { "sts:ExternalId": "EMERGENCY-2024-Q1-SECRET" },\n       "Bool": { "aws:MultiFactorAuthPresent": "true" },\n       "IpAddress": { "aws:SourceIp": "VENDOR-CORPORATE-IP/32" }\n     }\n   }\n   ```\n\n**2. Permissions Policy (Least Privilege)**:\n   \u2022 `ec2:DescribeInstances` (read-only discovery)\n   \u2022 `ec2:RebootInstances` (only specific instance IDs via resource-level permissions)\n   \u2022 `ec2:GetConsoleOutput` (for troubleshooting)\n   \u2022 **Explicit Deny**: All other actions, all other resources\n\n**3. Session Duration**: 30 minutes (minimum allowed by API is 15 min, but 30 is practical for emergency)\n\n**4. Approval Workflow**:\n   \u2022 External ID stored in AWS Secrets Manager\n   \u2022 Requires two security team members to retrieve (dual authorization)\n   \u2022 Secret auto-rotates after each use\n\n**5. Audit Trail**:\n   \u2022 CloudTrail logs: `sts:AssumeRole` with vendor identity\n   \u2022 Session name includes ticket number: `VendorEmergency-TICKET-12345`\n   \u2022 CloudWatch Alarm triggers on role assumption (real-time alert to security team)\n   \u2022 Lambda function auto-terminates sessions after 30 minutes (belt-and-suspenders)\n\n**6. Session Tracking**:\n   \u2022 Vendor must include `ExternalId` and `SessionName` in assume role call\n   \u2022 Session name format enforced: `VendorName-IncidentID-Date`\n\n**Execution**:\n1. Incident declared \u2192 Security team retrieves External ID from Secrets Manager (requires 2 approvals) \u2705\n2. Security team calls vendor, provides External ID over phone (out-of-band) \u2705\n3. Vendor assumes role with MFA + External ID + from corporate IP \u2705\n4. Real-time alerts fire to security team Slack \u2705\n5. Vendor fixes issue within 30 minutes \u2705\n6. Session expires, access auto-revoked \u2705\n7. CloudTrail logs archived for compliance review \u2705\n\n**Security Features**:\n\u2022 No standing access (zero trust) \u2705\n\u2022 Dual authorization for secret retrieval \u2705\n\u2022 Time-bound (30 min max) \u2705\n\u2022 Resource-constrained (specific EC2s only) \u2705\n\u2022 Complete audit trail \u2705\n\u2022 Out-of-band External ID distribution \u2705\n\u2022 Auto-termination failsafe \u2705\n\n**Post-Incident**: Rotate External ID, review CloudTrail logs, document lessons learned.',
        type: 'scenario',
        difficulty: 'advanced'
      },
      {
        id: 'sts-reflection-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Cross-Account Access and AWS STS',
        icon: '\ud83e\udd14',
        awsIcon: 'iam',
        question: 'REFLECTION: How does temporary credential usage via AWS STS when assuming cross-account roles fundamentally enhance security compared to long-term credential sharing in multi-account setups?',
        answer: '**The Security Transformation: From Static Secrets to Dynamic Trust** \ud83d\udd04\n\n**Long-Term Credential Model (The "Key Under the Mat")**:\n\u2022 **Static Risk**: Credentials valid indefinitely until manually changed \u274c\n\u2022 **Blast Radius**: One leak = permanent compromise until detected \u274c\n\u2022 **Operational Burden**: Rotation requires updating N accounts, coordinating across teams \u274c\n\u2022 **Audit Gap**: Hard to track which credentials were used when, by whom \u274c\n\u2022 **Revocation Lag**: Even after detection, disabling access takes time and coordination \u274c\n\n**STS Temporary Credential Model (The "Timed Access Pass")**:\n\u2022 **Temporal Security**: Credentials auto-expire (15 min - 12 hrs), limiting exposure window \u2705\n\u2022 **Contained Blast Radius**: Leaked credentials become useless after expiration \u2705\n\u2022 **Zero Operational Burden**: No rotation needed—credentials are ephemeral by design \u2705\n\u2022 **Complete Auditability**: Every assumption logged with source identity, time, and assumed role in CloudTrail \u2705\n\u2022 **Instant Revocation**: Stop assuming the role = immediate access termination (no credential to "revoke") \u2705\n\n**Fundamental Shift**:\n\n**Identity Management**: \n\u2022 Old: Manage identities in every account (credential sprawl)\n\u2022 New: Manage trust relationships, identities stay centralized\n\n**Security Posture**: \n\u2022 Old: Protect secrets forever (impossible)\n\u2022 New: Limit exposure time (achievable)\n\n**Compliance**: \n\u2022 Old: Prove you rotated keys every 90 days\n\u2022 New: Prove no session lasted longer than policy allows (automatic)\n\n**Multi-Account Scale**: \n\u2022 Old: 100 accounts \u00d7 10 users = 1,000 credentials to manage\n\u2022 New: 100 accounts \u00d7 1 trust policy = centralized access with decentralized permissions\n\n**The STS Paradigm**: Security through **ephemerality** rather than **secrecy**. Instead of trying to keep long-term secrets safe (which fails), we make secrets so short-lived that exposure becomes manageable. This enables true multi-account architectures where access is granted dynamically, audited completely, and revoked automatically—transforming AWS from a collection of isolated accounts into a unified, secure ecosystem.',
        type: 'concept',
        difficulty: 'advanced'
      },
            {
        id: 'tower-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83c\udfe2',
        awsIcon: 'organizations',
        question: 'Why would an organization use multiple AWS accounts instead of just one big account?',
        answer: '**"Don\'t Put All Your Eggs in One Basket"** \ud83e\udd5a\n\n**The Single Account Problem**:\n\u2022 50 developers + production + experiments = chaos \u274c\n\u2022 Someone deletes a resource? Could be production! \u274c\n\u2022 Billing nightmare - who spent what? \u274c\n\u2022 Security breach? Everything is compromised \u274c\n\n**The Multi-Account Solution**:\n\u2022 **Dev Account**: Developers can experiment freely \u2705\n\u2022 **Production Account**: Locked down, only approved changes \u2705\n\u2022 **Security Account**: Central logging, monitoring \u2705\n\u2022 **Sandbox Account**: Playground for testing \u2705\n\n**Result**: If dev account gets breached, production is safe!',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'tower-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83d\ude80',
        awsIcon: 'control-tower',
        question: 'What is AWS Control Tower in simple terms?',
        answer: '**AWS Control Tower = "Multi-Account Setup Wizard"** \ud83e\uddd9\u200d\u2642\ufe0f\n\n**What it does**:\n\u2022 Sets up a **Landing Zone** (secure baseline for multiple accounts)\n\u2022 Creates pre-configured accounts (Log Archive, Audit, Sandbox)\n\u2022 Applies **Guardrails** (automatic security rules)\n\u2022 Provides a **Dashboard** to view compliance across all accounts\n\n**Think of it as**: A construction foreman who builds your AWS "neighborhood" with proper roads (networking), security gates (guardrails), and utility connections (logging) - so you don\'t have to build from scratch.',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'tower-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83d\udee1\ufe0f',
        awsIcon: 'organizations',
        question: 'What are Service Control Policies (SCPs)?',
        answer: '**SCPs = "Master Rules" for Your Organization** \ud83d\udc65\n\n**What they are**:\n\u2022 Special policies attached to AWS Organization accounts or OUs\n\u2022 Define the **maximum permissions** allowed - like a ceiling\n\u2022 Apply to **all IAM users and roles** in the account (even root!)\n\u2022 **Preventative**: They block actions before they happen\n\n**Example**: "No account in the Development OU can delete CloudTrail logs"\n\n**Key Point**: SCPs don\'t grant permissions - they only restrict what permissions can be used. If SCP says "no", even the root user can\'t do it!',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'tower-4',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83c\udfaf',
        awsIcon: 'organizations',
        question: 'What is the difference between IAM Policies and SCPs?',
        answer: '**IAM Policies = "Can I Do This?" | SCPs = "Am I Allowed to Even Try?"** \n\n**IAM Policies** (Inside an account):\n\u2022 Grant permissions to users/roles\n\u2022 "John can access S3 bucket X"\n\u2022 Identity-based (who are you?)\n\n**SCPs** (Organization level):\n\u2022 Set maximum permissions boundary\n\u2022 "No one in this account can use expensive EC2 instances"\n\u2022 Resource-based (what can this account do?)\n\n**The Interaction**:\nEffective Permissions = IAM Permissions \u2229 SCP Permissions\n\n**Analogy**: IAM is your driver\'s license (what you can drive), SCP is the speed limit and road rules (what\'s allowed on this road).',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'tower-5',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83d\udcca',
        awsIcon: 'control-tower',
        question: 'What are "Guardrails" in AWS Control Tower?',
        answer: '**Guardrails = Pre-Packaged SCPs + Detective Controls** \ud83d\udea7\n\n**Two Types**:\n\n1. **Preventive Guardrails** (SCPs)\n   \u2022 Block actions before they happen\n   \u2022 Example: "Disallow deletion of log archive"\n   \u2022 Enforced via SCPs\n\n2. **Detective Guardrails** (AWS Config)\n   \u2022 Detect when policy is violated\n   \u2022 Example: "Detect if public read access enabled on S3 bucket"\n   \u2022 Triggers alerts, doesn\'t block\n\n**Control Tower provides**: 100+ pre-built guardrails you can enable with one click!',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'tower-mc-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\u2753',
        awsIcon: 'organizations',
        question: 'What is the primary purpose of AWS Control Tower?',
        options: [
          'To reduce AWS costs automatically',
          'To set up and govern a secure multi-account AWS environment',
          'To replace AWS Organizations',
          'To provide a single sign-on solution for AWS accounts'
        ],
        correctAnswer: 1,
        explanation: 'AWS Control Tower simplifies the setup and governance of a secure, compliant multi-account AWS environment by creating a landing zone with pre-configured accounts and applying guardrails (preventive and detective controls) across the organization.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'tower-mc-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\u2753',
        awsIcon: 'organizations',
        question: 'Who is affected by Service Control Policies (SCPs)?',
        options: [
          'Only IAM users, not IAM roles',
          'Only the root user of the account',
          'All IAM entities including the root user',
          'Only users in the management account'
        ],
        correctAnswer: 2,
        explanation: 'SCPs affect **all IAM entities** in the account, including the root user, IAM users, and IAM roles. They act as a permissions boundary that applies to everyone without exception, providing the ultimate guardrail for an AWS account.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'tower-mc-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\u2753',
        awsIcon: 'organizations',
        question: 'Do SCPs grant permissions to IAM users?',
        options: [
          'Yes, SCPs grant permissions just like IAM policies',
          'No, SCPs only restrict permissions that IAM policies have granted',
          'Yes, but only for the root user',
          'No, SCPs are only for billing purposes'
        ],
        correctAnswer: 1,
        explanation: 'SCPs do **not grant permissions** - they only act as a filter or boundary on what permissions can be used. An IAM user must still have permissions granted via IAM policies, and then SCPs determine if those permissions are allowed to be exercised.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'tower-scenario-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83d\udcbc',
        awsIcon: 'control-tower',
        question: 'SCENARIO: Your company has 5 AWS accounts. Developers keep accidentally spinning up expensive EC2 instances (x1e.32xlarge) in the dev account, costing thousands. How do you prevent this organization-wide?',
        answer: '**Use an SCP to Restrict EC2 Instance Types** \ud83d\udee1\ufe0f\n\n**The SCP**:\n```json\n{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Effect": "Deny",\n    "Action": "ec2:RunInstances",\n    "Resource": "arn:aws:ec2:*:*:instance/*",\n    "Condition": {\n      "ForAnyValue:StringNotLike": {\n        "ec2:InstanceType": [\n          "t3.*",\n          "t2.*",\n          "m5.*",\n          "m4.*"\n        ]\n      }\n    }\n  }]\n}\n```\n\n**Implementation**:\n1. Attach this SCP to the **Development OU** in AWS Organizations \u2705\n2. All dev accounts inherit the restriction \u2705\n3. Developers can still use IAM to grant `ec2:RunInstances` \u2705\n4. But SCP blocks anything not t3/t2/m5/m4 \u2705\n5. **Even root user** cannot launch x1e.32xlarge! \u2705\n\n**Result**: Cost control enforced at the organization level, regardless of individual account permissions.',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'tower-scenario-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83d\udd10',
        awsIcon: 'organizations',
        question: 'SCENARIO: A developer in your organization accidentally posted AWS access keys to GitHub. An attacker found them and tried to delete CloudTrail logs to cover their tracks. How do SCPs prevent this?',
        answer: '**Immutable Logging with SCP Protection** \ud83d\udcca\n\n**The Attack**:\n\u2022 Attacker has valid credentials \u274c\n\u2022 Tries to delete CloudTrail to hide evidence \u274c\n\u2022 Tries to disable Config to stop recording \u274c\n\n**The SCP Defense**:\n```json\n{\n  "Effect": "Deny",\n  "Action": [\n    "cloudtrail:DeleteTrail",\n    "cloudtrail:StopLogging",\n    "cloudtrail:UpdateTrail",\n    "config:DeleteConfigRule",\n    "config:DeleteConfigurationRecorder"\n  ],\n  "Resource": "*"\n}\n```\n\n**Why It Works**:\n\u2022 Attached to **all OUs** via Control Tower guardrail \u2705\n\u2022 Applies to **every IAM entity**, including compromised credentials \u2705\n\u2022 **Explicit Deny** cannot be overridden by any IAM policy \u2705\n\u2022 Attacker\'s API calls are blocked with "Access Denied" \u2705\n\u2022 CloudTrail continues logging their attempted actions! \u2705\n\n**Security Principle**: Defense in depth - even if credentials leak, critical security controls cannot be disabled.',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'tower-policy-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83d\udcc4',
        awsIcon: 'organizations',
        question: 'What does this SCP do?\n```json\n{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Sid": "DenyRegionUsage",\n    "Effect": "Deny",\n    "NotAction": [\n      "iam:*",\n      "organizations:*",\n      "account:*"\n    ],\n    "Resource": "*",\n    "Condition": {\n      "StringNotEquals": {\n        "aws:RequestedRegion": [\n          "us-east-1",\n          "us-west-2",\n          "eu-west-1"\n        ]\n      }\n    }\n  }]\n}\n```',
        answer: '**Restricts All Services to Specific Regions (with exceptions)** \ud83d\uddfa\ufe0f\n\n**Breakdown**:\n\u2022 `Effect: Deny` + `NotAction`: Deny everything EXCEPT IAM, Organizations, and Account services\n\u2022 `StringNotEquals`: If requested region is NOT in the allowed list...\n\u2022 Then DENY the API call\n\n**Allowed**: us-east-1, us-west-2, eu-west-1\n**Blocked**: All other regions (ap-south-1, sa-east-1, etc.)\n\n**Why `NotAction` for IAM/Orgs/Account?** These are global services that don\'t have region endpoints. If you blocked them, you couldn\'t manage users or the organization!\n\n**Use Case**: Data residency compliance (keep data in approved regions only).',
        type: 'code-analysis',
        difficulty: 'application'
      },
      {
        id: 'tower-concept-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83e\uddf5',
        awsIcon: 'organizations',
        question: 'How do SCPs enable "Defense in Depth" when combined with IAM policies?',
        answer: '**Layered Security: The Permissions Sandwich** \ud83e\uddf5\n\n**Layer 1 - SCPs (The Outer Wall)**:\n\u2022 Maximum permissions boundary\n\u2022 Organization-wide guardrails\n\u2022 Cannot be overridden by account admins\n\u2022 Protects against catastrophic actions\n\n**Layer 2 - IAM Policies (The Inner Gate)**:\n\u2022 Granular permissions for specific users/roles\n\u2022 Principle of least privilege\n\u2022 Resource-level and condition-based access\n\u2022 Managed by account owners\n\n**The Interaction**:\n```\nEffective Permissions = IAM Permissions \u2229 SCP Permissions\n```\n\n**Example**:\n\u2022 IAM: "Developer can delete S3 buckets in dev account"\n\u2022 SCP: "No one can delete buckets with tag Environment=Production"\n\u2022 Result: Developer can delete dev buckets, but SCP blocks any production bucket deletion even if IAM allows it\n\n**Defense in Depth**: If IAM policy is misconfigured (too permissive), SCP acts as safety net. If SCP is bypassed (impossible - org-level), IAM still restricts. Both must allow for action to succeed.',
        type: 'concept',
        difficulty: 'application'
      },
      {
        id: 'tower-scenario-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83c\udff0',
        awsIcon: 'control-tower',
        question: 'SCENARIO: You are setting up a new multi-account environment for a financial services company. They need: (1) strict separation between dev and prod, (2) central security logging, (3) prevention of public S3 buckets, (4) restriction to us-east-1 only. Architect this using Control Tower and SCPs.',
        answer: '**Financial Services Landing Zone Architecture** \ud83c\udff0\n\n**Control Tower Setup**:\n\n**1. Organizational Structure**:\n```\nRoot (Management Account)\n\u251c\u2500\u2500 Core OU\n\u2502   \u251c\u2500\u2500 Log Archive Account (immutable logs)\n\u2502   \u2514\u2500\u2500 Audit Account (Security tools, read-only access to all)\n\u251c\u2500\u2500 Production OU\n\u2502   \u251c\u2500\u2500 Production-App1 Account\n\u2502   \u2514\u2500\u2500 Production-App2 Account\n\u2514\u2500\u2500 Development OU\n    \u251c\u2500\u2500 Dev-App1 Account\n    \u2514\u2500\u2500 Dev-App2 Account\n```\n\n**2. SCPs Applied**:\n\n**A. Region Restriction (All OUs)**:\n```json\n{\n  "Effect": "Deny",\n  "NotAction": ["iam:*", "organizations:*"],\n  "Resource": "*",\n  "Condition": {\n    "StringNotEquals": {"aws:RequestedRegion": "us-east-1"}\n  }\n}\n```\n\n**B. Prevent Public S3 (All OUs)**:\n```json\n{\n  "Effect": "Deny",\n  "Action": "s3:PutBucketAcl",\n  "Resource": "*",\n  "Condition": {\n    "StringEquals": {"s3:x-amz-acl": ["public-read", "public-read-write"]}\n  }\n}\n```\n\n**C. Production Protection (Production OU only)**:\n```json\n{\n  "Effect": "Deny",\n  "Action": [\n    "ec2:DeleteVpc",\n    "rds:DeleteDBInstance",\n    "dynamodb:DeleteTable"\n  ],\n  "Resource": "*",\n  "Condition": {\n    "StringEquals": {"aws:ResourceTag/Environment": "Production"}\n  }\n}\n```\n\n**D. Dev Cost Controls (Development OU)**:\n```json\n{\n  "Effect": "Deny",\n  "Action": "ec2:RunInstances",\n  "Resource": "*",\n  "Condition": {\n    "ForAnyValue:StringLike": {\n      "ec2:InstanceType": ["*.large", "*.xlarge", "*.2xlarge"]\n    }\n  }\n}\n```\n\n**3. Control Tower Guardrails**:\n\u2022 **Preventive**: "Disallow deletion of CloudTrail logs", "Disallow public RDS snapshots"\n\u2022 **Detective**: "Detect whether MFA is enabled for root user", "Detect whether EBS volumes are encrypted"\n\n**4. Cross-Account Access**:\n\u2022 Security team in Audit Account assumes read-only roles in all workload accounts\n\u2022 CI/CD in Shared Services deploys to Dev/Prod using cross-account roles\n\u2022 Break-glass emergency access with approval workflow\n\n**5. Monitoring**:\n\u2022 All CloudTrail logs \u2192 Log Archive Account (SCP-protected from deletion)\n\u2022 AWS Config aggregators in Audit Account\n\u2022 GuardDuty findings centralized in Audit Account\n\u2022 Monthly compliance reports from Control Tower dashboard\n\n**Result**: Defense in depth with organization-level guardrails, strict isolation, centralized governance, and compliance automation.',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'tower-policy-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83d\udcc4',
        awsIcon: 'organizations',
        question: 'Analyze this advanced SCP using tags. What does it accomplish?\n```json\n{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Sid": "DenyEC2ModificationWithoutCostCenter",\n    "Effect": "Deny",\n    "Action": [\n      "ec2:RunInstances",\n      "ec2:CreateVolume"\n    ],\n    "Resource": [\n      "arn:aws:ec2:*:*:instance/*",\n      "arn:aws:ec2:*:*:volume/*"\n    ],\n    "Condition": {\n      "Null": {\n        "aws:RequestTag/CostCenter": "true"\n      }\n    }\n  }, {\n    "Sid": "DenyResourceModificationByNonOwner",\n    "Effect": "Deny",\n    "Action": [\n      "ec2:StopInstances",\n      "ec2:TerminateInstances"\n    ],\n    "Resource": "*",\n    "Condition": {\n      "StringNotEquals": {\n        "ec2:ResourceTag/Owner": "${aws:username}"\n      }\n    }\n  }]\n}\n```',
        answer: '**Attribute-Based Access Control (ABAC) via SCPs** \ud83c\udff7\ufe0f\n\n**Statement 1 - Mandatory Cost Center Tagging**:\n\u2022 **Blocks**: Running EC2 instances or creating EBS volumes WITHOUT a `CostCenter` tag\n\u2022 **Enforces**: All resources must have cost allocation tags\n\u2022 **Result**: 100% cost tracking compliance - can\'t launch without it!\n\n**Statement 2 - Resource Ownership Protection**:\n\u2022 **Blocks**: Stopping/terminating instances unless you are the owner\n\u2022 `${aws:username}` = IAM user who is making the API call\n\u2022 `ec2:ResourceTag/Owner` = Tag on the EC2 instance\n\u2022 **Result**: Developers can only manage their own resources, not teammates\'\n\n**Combined Effect**:\n\u2022 Financial governance (cost center required)\n\u2022 Operational safety (can\'t accidentally delete others\' work)\n\u2022 Self-service environment with guardrails\n\u2022 No need for complex IAM policies per user!\n\n**Advanced Use**: Combine with Control Tower tagging policies for automatic enforcement across the organization.',
        type: 'code-analysis',
        difficulty: 'advanced'
      },
      {
        id: 'tower-scenario-4',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83d\udea8',
        awsIcon: 'control-tower',
        question: 'SCENARIO: Your company is acquiring a startup that already has 10 AWS accounts with existing workloads. You need to bring them into your Control Tower landing zone without disrupting their operations, while gradually applying your security guardrails. How do you approach this?',
        answer: '**Gradual Account Migration Strategy** \ud83d\udd04\n\n**Phase 1: Assessment & Preparation (Week 1-2)**:\n\u2022 Inventory existing accounts using AWS Config aggregators\n\u2022 Identify existing IAM policies, roles, and permission boundaries\n\u2022 Map current resource usage against planned SCPs\n\u2022 **Risk Assessment**: Which SCPs would break existing automation?\n\n**Phase 2: Organization Invitation (Week 3)**:\n\u2022 Send invitations from your AWS Organizations master account\n\u2022 Startup accounts accept invitations (no workload disruption)\n\u2022 Move accounts into **Sandbox OU** initially (minimal SCPs)\n\n**Phase 3: Gradual SCP Application (Week 4-8)**:\n\n**Week 4**: Apply "Audit" SCPs only (logging, no restrictions)\n```json\n{\n  "Effect": "Deny",\n  "Action": [\n    "cloudtrail:StopLogging",\n    "config:DeleteConfigurationRecorder"\n  ],\n  "Resource": "*"\n}\n```\n\n**Week 6**: Add "Soft" Guardrails (warnings via AWS Config, not blocks)\n\u2022 Detective guardrails enabled\n\u2022 Teams notified of violations, given time to remediate\n\n**Week 8**: Apply "Hard" SCPs progressively\n\u2022 Region restrictions (if applicable)\n\u2022 Cost controls (instance type limits)\n\u2022 Security controls (public S3 prevention)\n\n**Phase 4: Production Migration (Week 9-12)**:\n\u2022 Move accounts from Sandbox OU to appropriate OUs (Dev/Prod)\n\u2022 Apply OU-specific SCPs\n\u2022 Enable cross-account access for central security monitoring\n\n**Critical Safeguards**:\n\u2022 **SCP Testing**: Use AWS IAM Access Analyzer to test SCPs against existing policies before deployment\n\u2022 **Break-Glass**: Maintain emergency access in case SCP blocks critical operations\n\u2022 **Rollback Plan**: Document SCP removal procedures\n\u2022 **Communication**: Weekly sync with startup team on upcoming restrictions\n\n**Automation**: Use Infrastructure as Code (Terraform/CloudFormation) to apply SCPs consistently, with automated testing in staging environment.\n\n**Result**: Zero downtime migration, gradual security posture improvement, maintained operational continuity.',
        type: 'scenario',
        difficulty: 'advanced'
      },
      {
        id: 'tower-concept-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\u2696\ufe0f',
        awsIcon: 'organizations',
        question: 'What are the trade-offs between centralized control via SCPs and developer autonomy/agility?',
        answer: '**The Governance-Agility Balance** \u2696\ufe0f\n\n**Centralized Control (SCPs) Benefits**:\n\u2705 **Consistency**: Same security rules everywhere\n\u2705 **Compliance**: Meet regulatory requirements organization-wide\n\u2705 **Cost Control**: Prevent expensive mistakes (x1e.32xlarge instances)\n\u2705 **Safety**: Prevent data leaks (public S3), deletion of logs\n\u2705 **Audit**: Single pane of glass for compliance\n\n**Centralized Control Costs**:\n\u274c **Friction**: Developers must request exceptions for new services\n\u274c **Innovation Slowdown**: Experimental services may be blocked\n\u274c **Operational Overhead**: Central team becomes bottleneck\n\u274c **Context Gap**: Central team doesn\'t understand workload needs\n\n**Finding the Balance**:\n\n**Tier 1 - Strict SCPs (No Exceptions)**:\n\u2022 Data residency (region restrictions)\n\u2022 Immutable logging (CloudTrail protection)\n\u2022 Root account protection (MFA enforcement)\n\u2022 **Rationale**: Security and compliance non-negotiables\n\n**Tier 2 - Standard SCPs (Exception Process)**:\n\u2022 Cost controls (instance type limits)\n\u2022 Encryption requirements\n\u2022 **Rationale**: Important but business needs may justify exceptions\n\n**Tier 3 - Guideline SCPs (Sandbox OUs)**:\n\u2022 Minimal restrictions in dedicated innovation accounts\n\u2022 Automatic cost alerts instead of blocks\n\u2022 **Rationale**: Enable experimentation, monitor and guide\n\n**Implementation Strategies**:\n\u2022 **OU Segmentation**: Sandbox (loose) vs Production (strict)\n\u2022 **Tag-Based Exceptions**: `ExceptionApproved=true` bypasses certain SCPs with approval workflow\n\u2022 **Time-Bound Exceptions**: Temporary SCP relaxation for migrations\n\u2022 **Self-Service**: Automated exception requests via Service Catalog\n\n**The Goal**: "Guardrails, not gates" - prevent accidents while enabling speed. SCPs should make the secure path the easy path, not block legitimate business needs.',
        type: 'concept',
        difficulty: 'advanced'
      },
      {
        id: 'tower-scenario-5',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83c\udfaf',
        awsIcon: 'control-tower',
        question: 'SCENARIO: You are the CISO of a healthcare company (HIPAA compliance required). You need to ensure that: (1) no PHI data leaves us-east-1, (2) all data is encrypted at rest and in transit, (3) no one can disable CloudTrail or Config, (4) only approved personnel can access production, (5) all resources are tagged with data classification. Design the complete SCP strategy.',
        answer: '**HIPAA-Compliant Multi-Account Architecture** \ud83c\udfe5\n\n**Organizational Structure**:\n```\nRoot (Management - No workloads)\n\u251c\u2500\u2500 Core OU (SCP: Protect foundation)\n\u2502   \u251c\u2500\u2500 Log Archive (Immutable, encrypted)\n\u2502   \u2514\u2500\u2500 Audit (Security tools, cross-account read-only)\n\u251c\u2500\u2500 Production OU (SCP: Maximum protection)\n\u2502   \u251c\u2500\u2500 PHI-Production Account (Critical)\n\u2502   \u2514\u2500\u2500 NonPHI-Production Account\n\u251c\u2500\u2500 Development OU (SCP: Controlled flexibility)\n\u2502   \u2514\u2500\u2500 Dev Account\n\u2514\u2500\u2500 Sandbox OU (SCP: Minimal, monitoring only)\n    \u2514\u2500\u2500 Experimentation Account\n```\n\n**SCP Strategy - Layered Defense**:\n\n**Layer 1: Foundation SCPs (All OUs)**:\n\n**A. Region Lock (Data Residency)**:\n```json\n{\n  "Effect": "Deny",\n  "NotAction": [\n    "iam:*",\n    "organizations:*",\n    "support:*",\n    "billing:*"\n  ],\n  "Resource": "*",\n  "Condition": {\n    "StringNotEquals": {\n      "aws:RequestedRegion": "us-east-1"\n    },\n    "Bool": {\n      "aws:ViaAWSService": "false"\n    }\n  }\n}\n```\n\u2022 **Exception**: Global services still work\n\u2022 **ViaAWSService**: Allows us-east-1 resources to call other regions if needed by AWS service\n\n**B. Immutable Security Logging**:\n```json\n{\n  "Effect": "Deny",\n  "Action": [\n    "cloudtrail:DeleteTrail",\n    "cloudtrail:StopLogging",\n    "cloudtrail:UpdateTrail",\n    "cloudtrail:PutEventSelectors",\n    "config:DeleteConfigRule",\n    "config:DeleteConfigurationRecorder",\n    "config:StopConfigurationRecorder"\n  ],\n  "Resource": "*"\n}\n```\n\n**C. Encryption Enforcement**:\n```json\n{\n  "Effect": "Deny",\n  "Action": [\n    "s3:PutObject",\n    "ebs:CreateVolume",\n    "rds:CreateDBInstance",\n    "dynamodb:CreateTable"\n  ],\n  "Resource": "*",\n  "Condition": {\n    "Bool": {\n      "aws:RequestTag/EncryptionVerified": "false"\n    }\n  }\n}\n```\n\u2022 Combined with Config rule that verifies encryption\n\u2022 Blocks unencrypted resource creation\n\n**Layer 2: Production OU SCPs**:\n\n**D. Production Protection**:\n```json\n{\n  "Effect": "Deny",\n  "Action": [\n    "ec2:TerminateInstances",\n    "rds:DeleteDBInstance",\n    "dynamodb:DeleteTable",\n    "s3:DeleteBucket"\n  ],\n  "Resource": "*",\n  "Condition": {\n    "StringEquals": {\n      "aws:ResourceTag/DataClassification": "PHI"\n    },\n    "ArnNotLike": {\n      "aws:PrincipalARN": [\n        "arn:aws:iam::*:role/BreakGlassEmergencyRole",\n        "arn:aws:iam::*:role/AutomatedBackupService"\n      ]\n    }\n  }\n}\n```\n\u2022 PHI-tagged resources cannot be deleted\n\u2022 Exception: Break-glass role (with approval workflow) and automated backup service\n\n**E. Mandatory Tagging (Data Classification)**:\n```json\n{\n  "Effect": "Deny",\n  "Action": [\n    "ec2:RunInstances",\n    "s3:CreateBucket",\n    "rds:CreateDBInstance"\n  ],\n  "Resource": "*",\n  "Condition": {\n    "Null": {\n      "aws:RequestTag/DataClassification": "true"\n    }\n  }\n}\n```\n\u2022 Values: `PHI`, `PII`, `Internal`, `Public`\n\u2022 Blocks resource creation without classification\n\n**Layer 3: Access Control SCPs**:\n\n**F. Privileged Access Restriction**:\n```json\n{\n  "Effect": "Deny",\n  "Action": [\n    "iam:CreateUser",\n    "iam:AttachUserPolicy",\n    "iam:CreateAccessKey"\n  ],\n  "Resource": "*",\n  "Condition": {\n    "ArnNotLike": {\n      "aws:PrincipalARN": "arn:aws:iam::*:role/IAMAdminRole"\n    }\n  }\n}\n```\n\u2022 Only IAMAdminRole can create users/attach policies\n\u2022 Prevents privilege escalation\n\n**Control Tower Guardrails**:\n\u2022 **Preventive**: "Disallow public read access to S3 buckets", "Disallow unencrypted RDS instances"\n\u2022 **Detective**: "Detect whether MFA is enabled for IAM users", "Detect whether EC2 volumes are encrypted"\n\n**Compliance Monitoring**:\n\u2022 **AWS Config**: Rules for HIPAA compliance (encrypted volumes, VPC flow logs)\n\u2022 **Security Hub**: Centralized compliance findings\n\u2022 **CloudTrail**: All API calls to immutable S3 in Log Archive account\n\u2022 **Macie**: Automated PHI detection in S3\n\n**Access Strategy**:\n\u2022 No human IAM users in Production OU accounts\n\u2022 Cross-account roles from Audit account with time-limited sessions\n\u2022 Break-glass procedure requires CISO approval + external ID + MFA + IP whitelist\n\n**Audit Trail**:\n\u2022 Every SCP change logged in CloudTrail\n\u2022 Monthly SCP compliance reports\n\u2022 Quarterly access reviews\n\n**Result**: Defense-in-depth with organization-level enforcement, HIPAA-compliant architecture, zero standing privileges in production, and immutable audit trails.',
        type: 'scenario',
        difficulty: 'advanced'
      },
      {
        id: 'tower-reflection-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Multi-Account Security: Control Tower & SCPs',
        icon: '\ud83e\udd14',
        awsIcon: 'organizations',
        question: 'REFLECTION: How do multi-account strategies (managed by Control Tower) and Service Control Policies (SCPs) fundamentally enhance security posture beyond individual account configurations, and what are the key benefits of this layered approach?',
        answer: '**The Security Architecture Revolution: From Perimeter to Organizational Immunity** \ud83c\udff0\n\n**Individual Account Security (The "Castle Defense")**:\n\u2022 **Scope**: Security configured per account (point solutions)\n\u2022 **Consistency**: Manual replication across accounts (error-prone)\n\u2022 **Boundaries**: Account-level IAM policies (can be overridden by root)\n\u2022 **Visibility**: Siloed CloudTrail, fragmented compliance view\n\u2022 **Response**: Reactive - detect and respond to each incident individually\n\u2022 **Scale**: O(n) management effort (each account is unique snowflake)\n\n**Multi-Account with Control Tower/SCPs (The "Immune System")**:\n\u2022 **Scope**: Organization-wide security DNA inherited by all accounts\n\u2022 **Consistency**: Automated guardrails applied uniformly (impossible to misconfigure)\n\u2022 **Boundaries**: SCPs create hard limits that apply to root users (ultimate authority)\n\u2022 **Visibility**: Centralized dashboard, unified compliance score across all accounts\n\u2022 **Response**: Proactive - prevent violations before they occur (preventive guardrails)\n\u2022 **Scale**: O(1) management effort (configure once, apply everywhere)\n\n**Fundamental Enhancements**:\n\n**1. The "Root User" Problem Solved**:\nIndividual accounts: Root user is god-mode, unstoppable\nWith SCPs: Root user is bound by organization-level guardrails. Even if credentials are compromised, critical actions are blocked.\n\n**2. The "Drift" Problem Solved**:\nIndividual accounts: Accounts diverge from security baseline over time (configuration drift)\nWith Control Tower: Continuous compliance monitoring, automatic remediation, drift detection\n\n**3. The "Blast Radius" Containment**:\nIndividual accounts: Breach in one account threatens everything (flat network)\nMulti-account: Account = security boundary. Dev breach doesn\'t affect production. Lateral movement requires cross-account role assumption (logged, controlled).\n\n**4. The "Governance at Scale" Reality**:\nIndividual accounts: 100 accounts \u00d7 100 security settings = 10,000 configurations to manage\nControl Tower: 100 accounts \u00d7 10 SCPs = 10 policies govern everything\n\n**The Layered Security Model**:\n\n```\nLayer 5: Application Security (Code, containers)\nLayer 4: Network Security (VPC, Security Groups)\nLayer 3: Identity Security (IAM, federation)\nLayer 2: Account Security (SCPs - The New Layer)\nLayer 1: Organizational Security (Control Tower guardrails, OUs)\nLayer 0: Physical/Infrastructure (AWS responsibility)\n```\n\n**SCPs as the "Kill Switch"**:\nUnlike other controls that can be bypassed with sufficient privileges, SCPs operate at the organization level. They are the ultimate safety net - the "air gap" between what IAM allows and what is actually possible.\n\n**Key Benefits Summary**:\n\n\u2705 **Immutable Guardrails**: Security rules that cannot be disabled by account admins\n\u2705 **Compliance Inheritance**: New accounts automatically compliant from creation\n\u2705 **Centralized Governance**: Single pane of glass for 1000+ accounts\n\u2705 **Defense in Depth**: IAM + SCPs = double authorization required\n\u2705 **Audit Simplicity**: Organization-wide CloudTrail, Config aggregators\n\u2705 **Cost Safety**: Prevent expensive resources at organization level\n\u2705 **Data Residency**: Enforce region restrictions globally\n\n**The Paradigm Shift**: From "securing accounts" to "architecting security into the organizational fabric." Control Tower and SCPs transform AWS from a collection of individual accounts into a unified, governable, secure ecosystem where security is the default state, not an afterthought.',
        type: 'concept',
        difficulty: 'advanced'
      },      {
        id: 'policies-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\ud83d\udc64',
        awsIcon: 'iam',
        question: 'What is an IAM policy (identity-based policy) in simple terms?',
        answer: '**IAM Policy = "What Can I Do?"** \ud83d\udc64\n\n**Attached to**: IAM users, groups, or roles\n\n**Answers the question**: As a user, what AWS resources can I access and what actions can I take?\n\n**Example**: "John (IAM user) can read from any S3 bucket and write to the dev-bucket"\n\n**Key Point**: The policy follows the identity. When John moves to a different project, his permissions move with him.',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'policies-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\ud83d\udce6',
        awsIcon: 's3',
        question: 'What is a resource policy (resource-based policy) in simple terms?',
        answer: '**Resource Policy = "Who Can Use Me?"** \ud83d\udce6\n\n**Attached to**: The AWS resource itself (S3 bucket, SQS queue, Lambda function, etc.)\n\n**Answers the question**: Who is allowed to access this specific resource?\n\n**Example**: "This S3 bucket allows Account B to read files, and denies everyone else"\n\n**Key Point**: The policy stays with the resource. It doesn\'t matter who you are - if the resource policy doesn\'t allow you, you can\'t access it.',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'policies-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\ud83d\udd17',
        awsIcon: 'iam',
        question: 'What is the key difference between IAM policies and resource policies?',
        answer: '**IAM = "I Can Access" | Resource = "You Can Access Me"** \ud83d\udd17\n\n**IAM Policy (Identity-Based)**:\n\u2022 Attached to WHO (user/role)\n\u2022 Defines WHAT they can do\n\u2022 Grants permissions TO an identity\n\n**Resource Policy (Resource-Based)**:\n\u2022 Attached to WHAT (resource)\n\u2022 Defines WHO can access it\n\u2022 Grants permissions ON a resource\n\n**Analogy**: \n\u2022 IAM policy = Your employee badge (what rooms you can enter)\n\u2022 Resource policy = The door lock (who can enter this room)\n\n**Both must agree** for access to be granted!',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'policies-4',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\ud83d\udccb',
        awsIcon: 'iam',
        question: 'Which AWS services support resource policies?',
        answer: '**Not all services support resource policies!** \ud83d\udccb\n\n**Services WITH Resource Policies**:\n\u2022 **S3** (bucket policies)\n\u2022 **SNS** (topic policies)\n\u2022 **SQS** (queue policies)\n\u2022 **Lambda** (function policies)\n\u2022 **API Gateway** (resource policies)\n\u2022 **KMS** (key policies)\n\u2022 **ECR** (repository policies)\n\u2022 **Secrets Manager** (secret policies)\n\n**Services WITHOUT Resource Policies**:\n\u2022 **EC2** (use security groups/IAM roles)\n\u2022 **RDS** (use IAM database authentication)\n\u2022 **DynamoDB** (use IAM policies only)\n\u2022 Most services rely on IAM policies only\n\n**Key Point**: Resource policies are common for data services that need cross-account access or public access controls.',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'policies-5',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\u2696\ufe0f',
        awsIcon: 'iam',
        question: 'How do IAM policies and resource policies work together?',
        answer: '**The "AND" Logic of Access Control** \u2696\ufe0f\n\n**For access to be granted, BOTH must allow it**:\n\n```\nAccess Granted = IAM Policy ALLOWS AND Resource Policy ALLOWS (or no resource policy)\n```\n\n**Scenarios**:\n1. **IAM allows, Resource allows** \u2705 = ACCESS GRANTED\n2. **IAM allows, Resource denies** \u274c = ACCESS DENIED\n3. **IAM denies, Resource allows** \u274c = ACCESS DENIED\n4. **IAM allows, No resource policy** \u2705 = ACCESS GRANTED (IAM only)\n\n**Key Point**: If a resource policy exists, it acts as an additional gate. If either gate says no, access is denied.',
        type: 'flashcard',
        difficulty: 'fundamental'
      },
      {
        id: 'policies-mc-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'An IAM user has full S3 permissions in their IAM policy, but the S3 bucket they want to access has a bucket policy that explicitly denies them. What happens?',
        options: [
          'Access is granted because IAM policy has higher priority',
          'Access is denied because the bucket policy denies it',
          'Access is granted because the IAM user is in the same account',
          'It depends on which policy was created first'
        ],
        correctAnswer: 1,
        explanation: '**Access is denied** because both IAM policies and resource policies must allow an action. An explicit deny in either policy (or a lack of allow in the resource policy) will block access. Resource policies act as an additional authorization layer.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'policies-mc-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\u2753',
        awsIcon: 's3',
        question: 'Which of the following is a resource-based policy?',
        options: [
          'A policy attached to an IAM user',
          'A policy attached to an IAM role',
          'A bucket policy attached to an S3 bucket',
          'An AWS managed policy'
        ],
        correctAnswer: 2,
        explanation: 'A **bucket policy attached to an S3 bucket** is a resource-based policy. It is embedded in the resource (the bucket) and defines who can access that specific resource. IAM user policies, role policies, and AWS managed policies are all identity-based policies.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'policies-mc-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\u2753',
        awsIcon: 'iam',
        question: 'When both an IAM policy and a resource policy exist, which statement is true?',
        options: [
          'The IAM policy always takes precedence',
          'The resource policy always takes precedence',
          'Both policies must allow the action for access to be granted',
          'The most recently updated policy takes precedence'
        ],
        correctAnswer: 2,
        explanation: 'When both policies exist, **both must allow the action** for access to be granted. This is an "AND" logic, not "OR". If either policy denies (or fails to explicitly allow) the action, access is denied. This provides defense in depth.',
        type: 'multiple-choice',
        difficulty: 'fundamental'
      },
      {
        id: 'policies-scenario-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\ud83d\udce4',
        awsIcon: 's3',
        question: 'SCENARIO: Company A wants to allow Company B to read files from their S3 bucket. Company A\'s admin gives Company B an IAM user with S3 read permissions. Company B still cannot access the bucket. Why?',
        answer: '**Missing Resource Policy (Bucket Policy)** \ud83d\udea8\n\n**The Setup**:\n\u2022 Company B has IAM user with `s3:GetObject` permission \u2705\n\u2022 But the S3 bucket is in Company A\'s account \u274c\n\n**The Problem**:\nS3 buckets are **private by default**. Even if Company B\'s IAM policy allows S3 access, the bucket policy in Company A must explicitly grant access to Company B.\n\n**The Fix - Bucket Policy in Company A**:\n```json\n{\n  "Effect": "Allow",\n  "Principal": {\n    "AWS": "arn:aws:iam::COMPANY-B-ACCOUNT-ID:root"\n  },\n  "Action": "s3:GetObject",\n  "Resource": "arn:aws:s3:::company-a-bucket/*"\n}\n```\n\n**Key Insight**: For cross-account access to resources with resource policies (S3, SNS, SQS, Lambda), **both** the identity\'s IAM policy AND the resource policy must allow it. The resource policy is essential for cross-account scenarios.',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'policies-scenario-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\ud83d\udd12',
        awsIcon: 'kms',
        question: 'SCENARIO: An application uses IAM role with full KMS permissions, but gets "Access Denied" when trying to encrypt data with a specific KMS key. The IAM policy looks correct. What is likely wrong?',
        answer: '**KMS Key Policy (Resource Policy) is Missing Permission** \ud83d\udd12\n\n**KMS is Special**: Every KMS key has a **key policy** (resource policy) that is required.\n\n**Default Key Policy**:\n```json\n{\n  "Effect": "Allow",\n  "Principal": {\n    "AWS": "arn:aws:iam::ACCOUNT-ID:root"\n  },\n  "Action": "kms:*",\n  "Resource": "*"\n}\n```\n\n**The Issue**: If the key policy only allows the account root, IAM policies can grant access. But if the key policy explicitly restricts principals, the IAM role must be listed in the key policy.\n\n**The Fix**: Add the application IAM role to the KMS key policy:\n```json\n{\n  "Effect": "Allow",\n  "Principal": {\n    "AWS": "arn:aws:iam::ACCOUNT-ID:role/AppRole"\n  },\n  "Action": [\n    "kms:Encrypt",\n    "kms:Decrypt"\n  ],\n  "Resource": "*"\n}\n```\n\n**KMS Lesson**: Unlike most services, KMS **requires** the key policy to explicitly allow the principal, even if IAM policy grants permission. IAM alone is not sufficient for KMS.',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'policies-policy-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\ud83d\udcc4',
        awsIcon: 's3',
        question: 'Analyze this S3 bucket policy. What does it do, and what IAM permissions would a user need to access the bucket?\n```json\n{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Effect": "Allow",\n    "Principal": {\n      "AWS": "arn:aws:iam::123456789012:user/John"\n    },\n    "Action": [\n      "s3:GetObject",\n      "s3:PutObject"\n    ],\n    "Resource": "arn:aws:s3:::reports-bucket/*"\n  }, {\n    "Effect": "Deny",\n    "Principal": "*",\n    "Action": "s3:*",\n    "Resource": "arn:aws:s3:::reports-bucket/*",\n    "Condition": {\n      "Bool": {\n        "aws:SecureTransport": "false"\n      }\n    }\n  }]\n}\n```',
        answer: '**Bucket Policy Analysis** \ud83d\udcca\n\n**Statement 1 - Allow**:\n\u2022 **Who**: Only IAM user "John" in account 123456789012\n\u2022 **What**: Can download (GetObject) and upload (PutObject) files\n\u2022 **Where**: Only in "reports-bucket"\n\n**Statement 2 - Deny**:\n\u2022 **Who**: Everyone ("*")\n\u2022 **What**: All S3 actions ("s3:*")\n\u2022 **When**: If NOT using HTTPS (`aws:SecureTransport: false`)\n\u2022 **Result**: Enforces encryption in transit for everyone!\n\n**Required IAM Policy for John**:\nJohn ALSO needs an IAM policy allowing these actions. The bucket policy alone is not enough.\n\n```json\n{\n  "Effect": "Allow",\n  "Action": [\n    "s3:GetObject",\n    "s3:PutObject"\n  ],\n  "Resource": "arn:aws:s3:::reports-bucket/*"\n}\n```\n\n**Effective Permissions**:\n\u2705 John can access via HTTPS (both policies allow)\n\u274c John cannot access via HTTP (bucket policy denies)\n\u274c Other users cannot access (bucket policy doesn\'t allow them)',
        type: 'code-analysis',
        difficulty: 'application'
      },
      {
        id: 'policies-concept-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\ud83e\uddf5',
        awsIcon: 'iam',
        question: 'Why do some services use resource policies while others rely only on IAM policies?',
        answer: '**The Cross-Account Access Problem** \ud83d\udd17\n\n**Services with Resource Policies** (S3, SNS, SQS, Lambda, KMS):\n\u2022 Need to grant access to **other accounts** (cross-account)\n\u2022 Need to grant access to **anonymous users** (public websites)\n\u2022 Need to grant access to **AWS services** (S3 triggering Lambda)\n\u2022 The resource itself needs to control who can touch it\n\n**Services without Resource Policies** (EC2, RDS, DynamoDB):\n\u2022 Access is always through IAM roles/users in the same account\n\u2022 Cross-account access is via **role assumption** (STS), not direct resource access\n\u2022 No need for resource-level access control beyond IAM\n\n**The Pattern**:\n\u2022 **Data/Integration services** (S3, SQS, SNS) = Resource policies needed for cross-account sharing\n\u2022 **Compute/Database services** (EC2, RDS) = IAM roles only, cross-account via STS\n\n**Key Insight**: Resource policies exist where resources need to be "shared" across account boundaries or with the public internet.',
        type: 'concept',
        difficulty: 'application'
      },
      {
        id: 'policies-scenario-3',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\ud83d\udea8',
        awsIcon: 's3',
        question: 'SCENARIO: A company accidentally made their S3 bucket public by adding "Principal": "*" in the bucket policy. Their IAM policies are strict and only allow specific users. Is the data secure?',
        answer: '**NO - The Bucket Policy Overrules IAM** \ud83d\udea8\n\n**The Misconfiguration**:\n```json\n{\n  "Effect": "Allow",\n  "Principal": "*",  // ANYONE ON THE INTERNET!\n  "Action": "s3:GetObject",\n  "Resource": "arn:aws:s3:::confidential-data/*"\n}\n```\n\n**Why It\'s Dangerous**:\n\u2022 **Resource policy allows**: Anyone, anywhere, no authentication needed \u274c\n\u2022 **IAM policy irrelevant**: Even if IAM is locked down, the bucket policy bypasses it \u274c\n\u2022 **Public data**: Confidential files are now on the open internet \u274c\n\n**The Rule**: For public access (Principal: "*"), **only the resource policy matters**. IAM policies are completely bypassed because there is no IAM identity!\n\n**The Fix**: Remove the wildcard principal:\n```json\n{\n  "Effect": "Allow",\n  "Principal": {\n    "AWS": "arn:aws:iam::YOUR-ACCOUNT-ID:role/AuthorizedRole"\n  },\n  "Action": "s3:GetObject",\n  "Resource": "arn:aws:s3:::confidential-data/*"\n}\n```\n\n**Security Lesson**: Resource policies can enable public access that completely bypasses your IAM security. Always audit resource policies for "Principal": "*".',
        type: 'scenario',
        difficulty: 'application'
      },
      {
        id: 'policies-policy-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\ud83d\udcc4',
        awsIcon: 'lambda',
        question: 'Analyze this Lambda function policy. When would this be used, and what are the security implications?\n```json\n{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Sid": "AllowS3Invoke",\n    "Effect": "Allow",\n    "Principal": {\n      "Service": "s3.amazonaws.com"\n    },\n    "Action": "lambda:InvokeFunction",\n    "Resource": "arn:aws:lambda:us-east-1:123456789012:function:ProcessUpload",\n    "Condition": {\n      "StringEquals": {\n        "AWS:SourceAccount": "123456789012"\n      },\n      "ArnLike": {\n        "AWS:SourceArn": "arn:aws:s3:::upload-bucket"\n      }\n    }\n  }]\n}\n```',
        answer: '**Lambda Resource Policy for S3 Trigger** \ud83d\udd04\n\n**What It Does**:\n\u2022 **Allows S3 service** to invoke this Lambda function\n\u2022 **Condition - SourceAccount**: Only S3 buckets in account 123456789012 (prevents confused deputy)\n\u2022 **Condition - SourceArn**: Only the specific "upload-bucket" can trigger it\n\u2022 **Use Case**: When a file is uploaded to S3, automatically trigger Lambda processing\n\n**Security Implications**:\n\n**Without Conditions (DANGEROUS)**:\n\u2022 Any S3 bucket in ANY AWS account could invoke your Lambda \u274c\n\u2022 Attackers could flood your Lambda with invocations \u274c\n\u2022 You pay for their invocations! \u274c\n\n**With Conditions (SECURE)**:\n\u2022 Only your specific bucket can trigger it \u2705\n\u2022 Prevents cross-account confused deputy attacks \u2705\n\u2022 Controls invocation costs \u2705\n\n**IAM Policy Needed**: The Lambda execution role still needs IAM permissions to read from S3 and write to CloudWatch logs. The resource policy only controls WHO can invoke the function, not what the function can do.',
        type: 'code-analysis',
        difficulty: 'advanced'
      },
      {
        id: 'policies-scenario-4',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\ud83d\udd10',
        awsIcon: 'iam',
        question: 'SCENARIO: You are designing a secure architecture where a Lambda function in Account A needs to write to an SQS queue in Account B. The SQS queue policy allows Account A\'s Lambda role. The Lambda has IAM permissions for SQS. Yet the write fails. What is wrong?',
        answer: '**Missing Cross-Account SQS Permission in IAM Policy** \ud83d\udea8\n\n**The Setup**:\n\u2022 **SQS Queue Policy (Account B)**: Allows `arn:aws:iam::Account-A:role/LambdaRole` to send messages \u2705\n\u2022 **Lambda IAM Policy (Account A)**: Has `sqs:SendMessage`... but only for local resources? \u274c\n\n**The Problem**: The Lambda\'s IAM policy likely looks like this:\n```json\n{\n  "Effect": "Allow",\n  "Action": "sqs:SendMessage",\n  "Resource": "arn:aws:sqs:us-east-1:Account-A:*"  // Only Account A queues!\n}\n```\n\n**The Fix**: IAM policy must explicitly allow the cross-account queue:\n```json\n{\n  "Effect": "Allow",\n  "Action": "sqs:SendMessage",\n  "Resource": "arn:aws:sqs:us-east-1:Account-B:cross-account-queue"\n}\n```\n\n**Key Insight for Cross-Account**:\n1. **IAM Policy** (in source account): Must allow access to the specific resource ARN in the target account\n2. **Resource Policy** (in target account): Must allow the principal from the source account\n\n**Both must explicitly reference the cross-account resource/principal!**',
        type: 'scenario',
        difficulty: 'advanced'
      },
      {
        id: 'policies-concept-2',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\u2696\ufe0f',
        awsIcon: 'iam',
        question: 'When should you use IAM policies vs. resource policies for access control? What are the trade-offs?',
        answer: '**IAM vs. Resource Policy Decision Matrix** \u2696\ufe0f\n\n**Use IAM Policies When**:\n\u2705 Centralized control is preferred (manage all permissions in IAM)\n\u2705 Access is within the same account\n\u2705 You want to use IAM groups and roles for easy management\n\u2705 Fine-grained permissions based on user attributes (ABAC)\n\u2705 You need to enforce MFA or other conditions across many resources\n\n**Use Resource Policies When**:\n\u2705 Cross-account access is needed (grant other accounts access)\n\u2705 Public/anonymous access is required (S3 static website)\n\u2705 AWS service integration (S3 triggers Lambda, SNS to SQS)\n\u2705 You want resource owners to control access (decentralized governance)\n\u2705 You need to enforce conditions specific to that resource (HTTPS only for this bucket)\n\n**Trade-offs**:\n\n**IAM Policies (Centralized)**:\n\u2705 Easier to audit all permissions in one place\n\u2705 Consistent enforcement across resources\n\u274c Can become complex with many resources\n\u274c Doesn\'t work for cross-account without resource policy support\n\n**Resource Policies (Decentralized)**:\n\u2705 Direct control at the resource level\n\u2705 Enables cross-account and public access\n\u2705 Resource owner manages their own access\n\u274c Harder to audit across hundreds of resources\n\u274c Risk of inconsistent security practices\n\u274c Can accidentally create public access\n\n**Best Practice**: Use IAM for internal access control, resource policies only when necessary (cross-account, public access, service integration).',
        type: 'concept',
        difficulty: 'advanced'
      },
      {
        id: 'policies-scenario-5',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\ud83c\udff0',
        awsIcon: 'iam',
        question: 'SCENARIO: You are the security architect for a multi-account AWS environment. You need to implement a strategy where: (1) developers can create S3 buckets but cannot make them public, (2) only the security team can create KMS keys, (3) all Lambda functions must be private (no public invoke), (4) cross-account access is allowed only to specific approved accounts. Design the IAM and resource policy strategy.',
        answer: '**Defense-in-Depth Policy Architecture** \ud83c\udff0\n\n**1. Prevent Public S3 Buckets (SCP + Resource Policy)**:\n\n**Organization SCP** (prevents bucket policy changes):\n```json\n{\n  "Effect": "Deny",\n  "Action": [\n    "s3:PutBucketPolicy",\n    "s3:PutBucketAcl",\n    "s3:PutBucketPublicAccessBlock"\n  ],\n  "Resource": "*",\n  "Condition": {\n    "StringEquals": {\n      "s3:x-amz-acl": ["public-read", "public-read-write", "authenticated-read"]\n    }\n  }\n}\n```\n\n**S3 Block Public Access** (account-wide setting):\n\u2022 Enable at account level to override any resource policy\n\u2022 Prevents "Principal": "*" in any bucket policy\n\n**2. Restrict KMS Key Creation (IAM Policy)**:\n\n**Developer IAM Policy**:\n```json\n{\n  "Effect": "Deny",\n  "Action": "kms:CreateKey",\n  "Resource": "*"\n}\n```\n\n**Security Team IAM Policy**:\n```json\n{\n  "Effect": "Allow",\n  "Action": "kms:*",\n  "Resource": "*"\n}\n```\n\n**3. Private Lambda Functions (Resource Policy + SCP)**:\n\n**Lambda Resource Policy Enforcement** (via SCP):\n```json\n{\n  "Effect": "Deny",\n  "Action": "lambda:AddPermission",\n  "Resource": "*",\n  "Condition": {\n    "StringEquals": {\n      "lambda:Principal": "*"\n    }\n  }\n}\n```\n\n**4. Controlled Cross-Account Access (IAM + Resource Policies)**:\n\n**Approved Account List** (in IAM policy conditions):\n```json\n{\n  "Effect": "Allow",\n  "Action": "sts:AssumeRole",\n  "Resource": "arn:aws:iam::*:role/CrossAccountAccessRole",\n  "Condition": {\n    "StringEquals": {\n      "aws:ResourceOrgID": "o-xxxxxxxxxx"  // Only accounts in your org\n    }\n  }\n}\n```\n\n**Resource Policy Template** (for approved cross-account):\n```json\n{\n  "Effect": "Allow",\n  "Principal": {\n    "AWS": "arn:aws:iam::TRUSTED-ACCOUNT-ID:root"\n  },\n  "Action": "s3:GetObject",\n  "Resource": "arn:aws:s3:::shared-bucket/*",\n  "Condition": {\n    "StringEquals": {\n      "aws:PrincipalOrgID": "o-xxxxxxxxxx"  // Double-check org membership\n    }\n  }\n}\n```\n\n**Implementation Strategy**:\n\u2022 **SCPs**: Prevent dangerous actions at organization level (public S3, anonymous Lambda)\n\u2022 **IAM Policies**: Grant permissions with conditions (org ID, approved accounts)\n\u2022 **Resource Policies**: Only for specific cross-account sharing, always with conditions\n\u2022 **AWS Config Rules**: Continuous monitoring for policy violations\n\u2022 **CloudTrail**: Log all policy changes for audit\n\n**Result**: Multiple layers of defense - SCPs block at org level, IAM restricts who can do what, resource policies control specific resource access, conditions enforce context (org membership, encryption).',
        type: 'scenario',
        difficulty: 'advanced'
      },
      {
        id: 'policies-reflection-1',
        domain: 'Domain 1: Design Secure Architectures',
        topic: 'Resource Policies vs. IAM Policies',
        icon: '\ud83e\udd14',
        awsIcon: 'iam',
        question: 'REFLECTION: How could misconfigurations involving both IAM policies and resource policies lead to unintended access or denial in cross-account scenarios, highlighting the importance of understanding their interplay?',
        answer: '**The Dangerous Intersection: When Policies Collide** \ud83d\udca5\n\n**Misconfiguration Pattern 1: The "False Security" Trap**:\n\u2022 **IAM Policy**: Grants broad S3 access ("s3:*" on "*")\n\u2022 **Resource Policy**: Also grants broad access to everyone\n\u2022 **Result**: Double permission = access works, but **both are too permissive**\n\u2022 **Danger**: Resource owner thinks IAM controls it, IAM admin thinks resource policy controls it. Neither realizes the other is wide open!\n\n**Misconfiguration Pattern 2: The "Silent Denial" Trap**:\n\u2022 **IAM Policy**: Grants specific access to cross-account resource\n\u2022 **Resource Policy**: Missing or denies the cross-account principal\n\u2022 **Result**: Application breaks mysteriously\n\u2022 **Debugging Nightmare**: Developer sees "Access Denied", checks IAM (looks good), never thinks to check resource policy in other account\n\n**Misconfiguration Pattern 3: The "Confused Deputy" Attack**:\n\u2022 **Resource Policy**: Allows "Principal": { "AWS": "arn:aws:iam::Account-A:root" }\n\u2022 **No Condition**: No ExternalId or SourceArn\n\u2022 **Attack**: Account C tricks Account A into accessing Account B\'s resource\n\u2022 **Result**: Unauthorized cross-account access via confused deputy\n\n**Misconfiguration Pattern 4: The "Public Resource" Catastrophe**:\n\u2022 **IAM Policy**: Locked down, perfect least privilege\n\u2022 **Resource Policy**: "Principal": "*" for S3 bucket (public access)\n\u2022 **Result**: **IAM policy completely bypassed** - anyone on internet can access\n\u2022 **Worst Case**: Data breach, compliance violation, immediate security incident\n\n**The Interplay Framework**:\n\n```\nAccess Decision = (IAM Policy Evaluation) \u2227 (Resource Policy Evaluation)\n\nWhere:\n- IAM Policy Evaluation = Identity has permission?\n- Resource Policy Evaluation = Resource allows this principal? (or no policy = allow)\n- \u2227 = AND logic (both must be true)\n```\n\n**Critical Insights**:\n\n1. **IAM policies cannot restrict what resource policies allow**: If a resource policy says "Principal: *", IAM is irrelevant. The resource policy wins by being too permissive.\n\n2. **Resource policies can block what IAM policies allow**: Even with admin IAM permissions, if the resource policy denies you, you are blocked.\n\n3. **Cross-account requires explicit permission in both**: The IAM policy must allow the resource ARN, the resource policy must allow the principal ARN. Neither can be implicit.\n\n4. **Public access is a resource policy decision**: Once "Principal": "*" is in a resource policy, authentication is bypassed. This is why S3 Block Public Access exists as a safety net.\n\n**The Governance Challenge**:\n\u2022 IAM policies are centralized (easy to audit)\n\u2022 Resource policies are distributed (hard to find all of them)\n\u2022 Both must be audited for comprehensive security\n\u2022 AWS IAM Access Analyzer helps find resource policies with external access\n\n**Defense Strategy**:\n1. **Use SCPs** to prevent creation of public resource policies\n2. **Use IAM Access Analyzer** to continuously monitor for resource policies granting external access\n3. **Standardize** on IAM for access control, use resource policies only for specific needs (cross-account, service integration)\n4. **Conditions** are mandatory in resource policies (SourceAccount, ExternalId, encryption)\n5. **Regular audits** of both IAM and resource policies together\n\n**The Fundamental Lesson**: IAM and resource policies are not alternatives - they are **complementary layers**. Security requires understanding how they interact, not just configuring one or the other. A secure architecture coordinates both, using each for what it does best, with neither being a single point of failure.',
        type: 'concept',
        difficulty: 'advanced'
      }
    ]
  },
  {
    id: 'task-1.2',
    name: 'Task 1.2: Design Secure Workloads and Applications',
    cards: []
  },
  {
    id: 'task-1.3',
    name: 'Task 1.3: Determine Appropriate Data Security Controls',
    cards: []
  }
];
